location.hash&&0<=location.hash.indexOf("page=")&&(location.href="index_"+location.hash.match(/page=([\d]*)/)[1]+".html"+location.hash);function __updateLoginSta(b){document.getElementById("_userlogin").innerHTML=b}var VideoPart={nodedata:[],tempParts:null,listId:"#alist, #plist",collapse:function(u){var t=document.getElementById("dedepagetitles"),s=this.nodedata,r=this,q=0,p,o=0;u=u||window.pageno;null==t?t=this.tempParts:this.tempParts=t;if(t){for(p=0;p<t.length;p++){s[q++]=[$(t.options[p]).html(),$(t.options[p]).val(),$(t.options[p]).attr("cid")]}t=$(this.listId).empty().removeClass().addClass("plist-content");u=parseInt(u)||1;var n=0,l,j;for(p=3<q?u-2:0;p<u+5&&!(void 0!==s[p]&&(p==u-1?j=$('<span class="curPage">'+s[p][0]+"</span>\n"):(j=$('<a data-index="'+p+'">'+s[p][0]+"</a>\n"),j.off("click.callPlayer").on("click.callPlayer",function(){var b=$(this).data("index");callPlayer("cid="+s[b][2]+"&aid="+window.aid,b)})),l=r.caculate(j),l>n&&(n=l),t.append(j),o++,o>=this._getCol(n)));p++){}if(q>o){$('<a class="v-part-toggle">\u5c55\u5f00</a>').appendTo(t).on("click",function(){r.expand(u)})}t.addClass("p-c"+o);this._bindTitle(t.children().not(".v-part-toggle, .p-close"));this.copyright()}},expand:function(h){var g=$(this.listId),m=this.nodedata,l=this;g.addClass("open").empty();for(i=0;i<m.length;i++){var k="";i==h-1?k=$('<span class="curPage">'+m[i][0]+"</span>\n"):(k=$('<a data-index="'+i+'">'+m[i][0]+"</a>\n"),k.off("click.callPlayer").on("click.callPlayer",function(){var b=$(this).data("index");callPlayer("cid="+m[b][2]+"&aid="+window.aid,b)}));g.append(k)}this.setView($(this.listId));g.height();var j=$('<div class="p-close">\u6536\u8d77</div>').appendTo(g).on("click",function(){$(window).off("scroll.p-close");l.collapse(h);g.offset().top<$(window).scrollTop()&&$(window).scrollTop($(".viewbox").offset().top)});$(window).on("scroll.p-close",function(){if(20>g.offset().top-$(window).scrollTop()){var b=$(window).scrollTop()-g.offset().top+20;b<g.outerHeight()-j.outerHeight()-20?j.css("top",b):j.css("top",g.height()-j.outerHeight()-20)}else{j.css("top",0)}})},setView:function(f){var e=$(this.listId);e.width();var h=this,g=0;f=f.children().not(".v-part-toggle, .p-close");f.each(function(d,c){var j=$(c),j=h.caculate(j);j>g&&(g=j)});e.removeClass("p-c3, p-c4, p-c5, p-c6, p-c7").addClass("p-c"+this._getCol(g));this._bindTitle(f)},_bindTitle:function(d){var c=this;d.hover(function(){var b=$(this);if(!(b.outerWidth()>=c.caculate(b))){var e=$('<div class="p-float-txt"></div>');e.html(b.text());e.appendTo("body");e.css({top:b.offset().top-e.outerHeight()-8,left:b.offset().left});e.animate({top:"+=5",opacity:1})}},function(){$(".p-float-txt").remove()})},_getCol:function(b){return 255<=b?3:200<=b?4:163<=b?5:137<=b?6:7},caculate:function(d){d=$("<div>").html(d.html()).css({position:"absolute",top:0,left:0,"line-height":d.css("line-height"),visibility:"hidden","white-space":"nowrap","padding-left":d.css("padding-left"),"padding-right":d.css("padding-right"),border:"1px solid transparent"}).appendTo("body");$(this.listId).width();var c;c=d.outerWidth();d.remove();return c},copyright:function(){function k(){$(j.children()[0]).remove();j.children().each(function(e,d){d=$(d);var f=d.html();d.html(f.replace(/.*\u3001/,""))});j.find(".curPage").prependTo(j)}var j=$(this.listId),q=this.nodedata,p=JSON.parse(ChatGetSettings("cp_bangumi_record"));null==p&&(p={});var o=$("#bofqi"),n=!1,m=o.html().match(/\[\[(.*)\]\]/)||$(j.children()[0]).html().match(/\[\[(.*)\]\]/);if(null!=m&&"undefined"!=typeof m[1]&&"copyright"==m[1]||"undefined"!=typeof p[aid]){n=!0}if(n){if(j.delegate("a","click",function(){if(!$(this).attr("id")){var d=p[aid],c;d:{c=$(this);for(var f=0;f<q.length;f++){if(c.attr("href")==q[f][1]){c=f;break d}}c=void 0}d.p=c+1;ChatSaveSettings("cp_bangumi_record",JSON.stringify(p))}}),1<q.length&&(0>location.href.indexOf("index_")||0<=location.href.indexOf("index_1"))){if(o.hide(),o.html(),o.empty(),j.hide(),"undefined"!=typeof p[aid]){location.href="/video/av"+aid+"/index_"+p[aid].p+".html"}else{p[aid]={};o=$('<div class="player-placeholder"><div class="btn-wrapper"><div class="player-placeholder-head">\u8bf7\u9009\u62e9\u89c6\u9891\u6e90</div></div></div>').insertAfter(o).find(".btn-wrapper");n=5<q.length?4:q.length-1;for(m=0;m<n;m++){2==n?o.addClass("n2"):3==n?o.addClass("n3"):4<=n&&o.addClass("n4");var l=$('<div class="src-btn"><a href="'+q[m+1][1]+'">'+q[m+1][0].replace(/.*\u3001/,"")+"</a></div>").appendTo(o);(function(b){l.click(function(){p[aid].p=b+2;ChatSaveSettings("cp_bangumi_record",JSON.stringify(p))})})(m)}k()}}else{1<q.length&&0<=location.href.indexOf("index_")&&(3<q.length&&this.expand(),k())}}}};function callPlayer(e,d){$("#plist").hasClass("open")?VideoPart.expand(d+1):VideoPart.collapse(d+1);var f=location.href.match(/.*av[\d]*/)+"/index_"+(d+1)+".html";lrurl(window.aid,d+1,f);window.location.hash="#page="+(d+1);(f=$(".v-title h1").text().match(/(.*)(\(\d+\))$/))&&$(".v-title h1").text(f[1]+"("+(d+1)+")");window.GrayManager&&window.GrayManager.reload(e);window.BiliCm&&window.BiliCm.Core&&window.BiliCm.Core.reset();$(".p-float-txt").remove()}var js_viewallalist=utils.bindFn(VideoPart.collapse,VideoPart),kwtags=function(){};function callSpecPart(f,e){var h=VideoPart.nodedata;if(f&&totalpage&&null!=h&&0<f){if(f<=totalpage&&f<=h.length&&(void 0==top.allowSwitchPart||top.allowSwitchPart)){if("undefined"!=typeof e&&e){window.location.hash="#page="+f;VideoPart.collapse(f);var h=$("#qr_code"),g=location.href.match(/.*av[\d]*/)+"/index_"+f+".html";h.empty().qrcode($.extend(h.data("qrcode"),{text:g}));lrurl(window.aid,f,g)}else{window.location=h[f-1][1]}}else{void 0!=window.parent.callNextSpec&&window.parent.callNextSpec()}}}function callNextPart(b){window.pageno++;callSpecPart(parseInt(window.pageno),b)}function callAppointPart(b){window.pageno=b;callSpecPart(b,player)}function lrurl(e,d,f){e=e||window.aid;d=d||window.pageno;f=f||window.location.href;$("#link1").val("static.hdslb.com/miniloader.swf?aid="+e+"&page="+d);$("#link2").val('<embed height="415" width="544" quality="high" allowfullscreen="true" type="application/x-shockwave-flash" src="//static.hdslb.com/miniloader.swf" flashvars="aid='+e+"&page="+d+'" pluginspage="//www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash"></embed>');$("#link0").val(f);e=$("#btn_weixin .qr-code");e.empty().qrcode($.extend(e.data("qrcode"),{text:f}));f=$("#plist .curPage");f.length?$("#qr_description").html(f.html()):$("#qr_description").html("")}function copy_clip(b){b=$(b)[0];b.focus();b.setSelectionRange(0,b.value.length);document.execCommand("copy",!0);return !1}function showVideoInfo(b){$(b).find("img").attr("src",utils.trimHttp($(b).find("img").attr("_src")));$(b).find("img").css("top",$(b).position().top+18);$(b).find("img").css("left",630<$(b).position().left?630:$(b).position().left);$(b).find("img").css("position","absolute");$(b).find("img").css("display","block")}function hideVideoInfo(b){$(b).find("img").hide()}function player_fullwin(f){!1==f&&$("#bofqi").removeClass("wide");if(!1!=f||null!==ff_embed_stack){if(null===ff_embed_stack){ff_embed_stack=[];ff_embed_stack_style=[];var e=$("#bofqi").get(0);do{$(e).attr("embed_stack",!0),ff_embed_stack.push(e)}while(e=e.parentNode)}f?($(".rklist").hide(),$("#bofqi").addClass("webfullscreen")):($(".rklist").show(),$("#bofqi").removeClass("webfullscreen"));var e=$("div").not("#bofqi div"),h;for(h in e){if(e[h]&&e[h].getAttribute&&!e[h].getAttribute("embed_stack")&&e[h]&&e[h].style){var g;e[h].getAttribute("ff_id")?g=ff_status[e[h].getAttribute("ff_id")]:(ff_status_id++,e[h].setAttribute("ff_id",ff_status_id),ff_status[ff_status_id]=e[h].style.display);e[h].style.display=f?"none":g}}for(h in ff_embed_stack){(e=ff_embed_stack[h])&&e.style&&(ff_embed_stack_style[h]||(ff_embed_stack_style[h]={position:e.style.position,width:e.style.width,height:e.style.height,padding:e.style.padding,margin:e.style.margin,style:e.style.cssText}),f?(e.style.position="fixed",e.style.width="100%",e.style.height="100%",e.style.padding="0 0",e.style.margin="0 0"):e.style.cssText=ff_embed_stack_style[h].style)}f||(ff_embed_stack=null)}}var ff_status={},ff_status_id=0,ff_embed_stack=null,ff_embed_stack_style=null;function player_widewin(){$("#bofqi").removeClass("webfullscreen");$("#bofqi").addClass("wide")}function loadco(){clearInterval(int_fblogin);"undefined"!=typeof AjaxPage&&AjaxPage(1)}function flv_checkLogin(){return void 0!==GetCookie("DedeUserID")&&GetCookie("DedeUserID")?!0:!1}function checkBrowser(){$.browser.mozilla||$("#browser_tips").length||(tips_str='<div class="ui-widget" id="browser_tips" style="margin:0px;">   <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">            <ul id="icons" class="ui-widget ui-helper-clearfix" style="width:19px;float:right">               <li class="ui-state-default ui-corner-all" style="cursor:pointer;" onclick="$(\'#browser_tips\').toggle( \'fold\', {}, 500 );"><span class="ui-icon ui-icon-closethick"></span></li>            </ul>       <p id="browser_tips_msg"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;margin-top:.1em;"></span></p>   </div></div>',$.browser.webkit&&navigator.userAgent.match(/(chrome)[ \/]([\w.]+)/i))}var autofresh_interval=null;function init_autofresh(d,c){autofresh_interval=setInterval(function(){var a=document.createElement("script");a.src="/plus/count.php?papa=yes&reload="+Math.random()+"&aid="+d+"&mid="+c;a.type="text/javascript";a.language="javascript";document.body.appendChild(a)},30000)}function heimu(d,c){$("#heimu");0==c?($("#heimu").hide(),$("#bofqi").removeClass("heimu")):($("#bofqi").addClass("heimu"),$("#heimu").css("opacity","."+d/10),$("#heimu").css("filter","alpha(opacity="+d+")"),$("#heimu").show())}function flashChecker(){var f,e=!1,h=0;if(navigator.plugins&&0<navigator.plugins.length&&(f=navigator.plugins["Shockwave Flash"])){e=!0;f=f.description.split(" ");for(var g=0;g<f.length;++g){isNaN(parseInt(f[g]))||(h=parseInt(f[g]))}}return{hasFlash:e,flashVersion:h}}function loadHTML5(g,f){var k=null!=navigator.userAgent.match(/iPad/i)||null!=navigator.userAgent.match(/iPhone/i)||null!=navigator.userAgent.match(/iPod/i),j=null!=navigator.userAgent.match(/Android/i);if(!flashChecker().hasFlash&&(k||j)){var h=1==Number(f)?"":"#page="+f;!/iPad/.test(navigator.userAgent)&&"#html5"!=location.hash||"YESYESYES"==ChatGetSettings("bilibililover")?__GetCookie("nmr")&&"0"!=__GetCookie("nmr")||window.location.replace("/mobile/video/av"+g+".html"+h):$.getJSON("/m/html5?aid="+g+"&page="+f+"&sid="+__GetCookie("sid"),function(a){"undefined"==typeof a.src?window.location.replace("//m.acg.tv/video/av"+g+".html"+h):(window.html5data=a,$("#bofqi").html('<link type="text/css" href="//static.hdslb.com/css/simple.v2.min.css" rel="stylesheet" />'),$.getScript("//static.hdslb.com/js/simple.v2.min.js",function(){(new BiliH5Player).create({get_from_local:!0,comment:window.html5data.cid,image:utils.trimHttp(window.html5data.img),video_url:utils.trimHttp(window.html5data.src)})}),$("#bofqi").prepend('<div class="main-inner"><div class="app-banner"><div class="app-banner-left"><div class="app-banner-title">\u4e0abilibili\u5ba2\u6237\u7aef</div><div class="app-banner-content">\u9ad8\u6e05\u52a8\u753b \u79bb\u7ebf\u89c2\u770b \u5e94\u6709\u5c3d\u6709</div></div><div class="app-banner-right"><a class="app-open-btn">\u7528\u5ba2\u6237\u7aef\u6253\u5f00</a><a class="app-dl-btn">\u7acb\u5373\u4e0b\u8f7d</a></div></div></div>'),$(".app-banner .app-open-btn").bindApplink({aid:g}),getDownloadUrl($(".app-banner .app-dl-btn")))})}}function bindRIAttent(){$(".r-info > .f").off("click").click(function(){attentionTrigger(!0,14)})}function bindRIUnattent(){var b=$(".r-info > .f");b.hover(function(){b.text("\u53d6\u6d88\u5173\u6ce8").addClass("hover")},function(){b.text("\u5df2\u5173\u6ce8").removeClass("hover")});b.off("click").click(function(){$(this);attentionTrigger(!1,14)})}function attentionTrigger(f,e){e||(e=17);var h=$(".r-info > .f"),g=$(".r-info > .elec");f?(followUser(h,parseInt(h.attr("mid")),e,function(b){h.animate({opacity:0},{duration:300,complete:function(){h.text("\u5df2\u5173\u6ce8").css({border:"1px solid #e5e9ef",backgroundColor:"#fff",color:"#99a2aa"}).hover(function(){$(this).css({backgroundColor:"#fff",border:"1px solid #e5e9ef"})},function(){$(this).css({backgroundColor:"#fff",border:"1px solid #e5e9ef"})});h.animate({opacity:1},{duration:300,complete:function(){h.delay(300).animate({width:"68px"},{duration:300});g.delay(300).animate({width:"138px"},{duration:300,complete:function(){g.text("\u4e3aTA\u5145\u7535").addClass("animate")}})}});bindRIUnattent()}}).off("click")},function(){loadRelation(function(b){b&&h.animate({opacity:0},{duration:300,complete:function(){h.text("\u5df2\u5173\u6ce8").css({border:"1px solid #e5e9ef",backgroundColor:"#fff",color:"#99a2aa"}).hover(function(){$(this).css({backgroundColor:"#fff",border:"1px solid #e5e9ef"})},function(){$(this).css({backgroundColor:"#fff",border:"1px solid #e5e9ef"})});h.animate({opacity:1},{duration:300,complete:function(){h.delay(300).animate({width:"68px"},{duration:300});g.delay(300).animate({width:"138px"},{duration:300,complete:function(){g.text("\u4e3aTA\u5145\u7535").addClass("animate")}})}})}})})}),utils.customReport("playpage_follow1")):(unfollowUser(h,parseInt(h.attr("mid")),e,function(b){h.animate({opacity:0},{duration:300,complete:function(){h.text("+ \u5173\u6ce8").css({backgroundColor:"#00a1d6",border:"1px solid #00a1d6",color:"#fff"}).hover(function(){$(this).css({backgroundColor:"#00b5e5",border:"1px solid #00b5e5"})},function(){$(this).css({backgroundColor:"#00a1d6",border:"1px solid #00a1d6"})});h.animate({opacity:1},{duration:300,complete:function(){h.delay(300).animate({width:"138px"},{duration:300,complete:function(){h.removeClass("animate on hover")}});g.delay(300).animate({width:"68px"},{duration:300,complete:function(){g.text("\u5145\u7535").removeClass("animate on hover")}})}});bindRIAttent()}}).off("click").off("hover")},window.isQuietAttention),utils.customReport("playpage_unfollow1"))}function getAuthorInfo(){var f,e=parseInt(window.mid),h,g=!1;0<=$.inArray(e,window.AttentionList)&&(g=!0);$(".upinfo").length?(f=$(".upinfo"),h=$(".name",f).text(),f=utils.trimHttp($(".u-face img",f).attr("src"))):($upinfo=$(".zu_play_info"),h=$(".upload_user a",f).attr("card"),f=utils.trimHttp($(".upload_user img",f).attr("src")));return{mid:e,uname:h,face:f,attention:g}}var loader=new LazyJSONLoader,bbBangumiSp=function(j,h,o,n,m,l){var k=this;this.$container=$(".v_bgm_list");this._aId=parseInt(j);this._page=parseInt(m);this._spId=parseInt(h);this._seasonId=parseInt(o);this._rawcode=n;this._apiBase="//app.bilibili.com/bangumi";this._dataCache={};this._isbangumi=parseInt(l);1===this._isbangumi?(this.loadBangumi(j),window.seasonJsonCallback=function(e){$(".v_bgm_list").show();if(0==e.code){k._seasonId=e.result.season_id;k._seasonData=e.result.seasons;var d=k.sortEp(e.result.episodes);k._dataCache[k._apiBase+"/seasoninfo/"+e.result.season_id+".ver"]=d;k.$container.find(".bangumi-head a").text(e.result.title).attr("href","//bangumi.bilibili.com/anime/"+e.result.season_id+"/");k.$container.attr("data-seasonid",e.result.season_id);k.$container.find("#subscribe_num").text(formatFriendlyNumber(e.result.favorites));if(e.result.evaluate){var f=$("#bangumi_info");f.find(".info-content[type=description] .info-content-inner").text(e.result.evaluate).css("white-space","pre-wrap");f.find(".info-content[type=staff] .info-content-inner").text(e.result.staff).css("white-space","pre-wrap");f.find(".info-content[type=cv] .info-content-inner").html(function(){for(var a="",p=0;p<e.result.actor.length;p++){var g=e.result.actor[p],a=a+('<div class="cv-item">'+g.role+"\uff1a"+g.actor+"</div>")}return a})}e.result.cover&&(k.$container.find(".preview").wrapInner('<a target="_blank" href="//bangumi.bilibili.com/anime/'+e.result.season_id+'/"></a>'),k.$container.find(".preview img").attr("src",utils.trimHttp(e.result.cover)));k.parseEpisodeData(d);k.drawSeason();UserStatus.onLoaded(function(b){b.isLogin&&$.get("/api_proxy?app=bangumi&action=user_season_status&season_id="+k._seasonId,function(c){0==c.code&&showSpAdbtn(c.result.attention,null,k._seasonId)})})}}):o?this.loadSeason(h):this.loadEpisode2();$("#v_bgm_list_toggle").click(function(){k.toggleList()})};bbBangumiSp.prototype={_rawcode:null,_seasonData:null,_episodeData:null,_aId:null,_page:null,_spId:null,_seasonId:null,_totalPage:0,_maxPerPage:20,_pageLimit:20,_progressReported:!1,ajaxJsonp:function(g,f,k,j){var h=this;$.ajax({url:g,data:f,dataType:"jsonp",jsonp:"callback",jsonpCallback:k,error:j}).complete(function(){h._loading=!1})},loadBangumi:function(b){this.ajaxJsonp(this._apiBase+"/avseason/"+b+".ver",{},"seasonJsonCallback")},sortEp:function(e){var d=[],f;for(f=e.length-1;0<=f;f--){d.push(e[f])}return d},loadEpisode:function(e){if(1!==this._isbangumi){return this.loadEpisode2(e)}var d=this,f=this._apiBase+"/seasoninfo/"+e+".ver";this._dataCache[f]?this.parseEpisodeData(this._dataCache[f]):(window.episodeJsonCallback=function(b){0==b.code&&(b=d.sortEp(b.result.episodes),d._dataCache[f]=b,d.parseEpisodeData(b))},this._loading=!0,this.ajaxJsonp(f,{},"episodeJsonCallback"))},parseEpisodeData:function(b){$(".v_bgm_list").show();$("#v_bgm_list_page").hide().html("");$("#v_bgm_list_data").removeClass("on");$("#v_bgm_list_toggle .autoheight").removeClass("active");this._episodeData=b;this.drawFull(this.getPageByAid())},loadSeason:function(d){var c=this;loader.getJSON("/index/bangumi/"+d+"-sl.json",function(b){b&&(c._seasonData=b,c.drawSeason(),c.loadEpisode2(c._seasonId))})},loadEpisode2:function(d){var c=this;loader.getJSON(d?"/index/bangumi/"+this._spId+"-s"+d+".json":"/index/bangumi/"+this._spId+"-s0.json",function(b){$(".v_bgm_list").show();$("#v_bgm_list_page").hide().html("");$("#v_bgm_list_data").removeClass("on");$("#v_bgm_list_toggle .autoheight").removeClass("active");c._episodeData=c._normalize(b);c.drawFull(c.getPageByAid())})},toggleList:function(){var b=$("#v_bgm_list_data");b.hasClass("on")?(this.drawPart(),b.removeClass("on"),$("#v_bgm_list_page").hide(),$("#v_bgm_list_toggle .autoheight").removeClass("active")):(this.drawFull(this.getPageByAid()),b.addClass("on"),$("#v_bgm_list_toggle .autoheight").addClass("active"))},getPageByAid:function(){var b=0;this._episodeData.length>this._maxPerPage&&(b=parseInt(this.episodeByAid(this._aId,this._page)/this._maxPerPage));return b},drawSeason:function(h){this._seasonId=h=h||this._seasonId;var g,m=Math.ceil(2.5),l,k=$("#v_bgm_list_tab");$("#v_bgm_list_tab").html("");l=this.seasonByAid(h);if((h=this._seasonData.length)&&1!=h){g=5>=h?0:Math.max(0,l-m);m=5>=h?h-1:Math.min(l+m,h-1);for(5<h&&(0==g?m=4:m==h-1&&(g=h-5));g<=m;g++){if(l=this._seasonData[g]){l=this.createSeasonItem(k,l),k.append(l)}}if(5<h){var k=$('<li class="bgm-list-btn"><i class="b-icon b-icon-arrow-d"></i></li>').appendTo(k),j=$('<ul class="bgm-list-panel"></li>').hide().appendTo(k);k.hover(function(){j.stop(!0,!0).slideDown(200)},function(){j.stop(!0,!0).slideUp(200)});for(g=0;g<h;g++){if(l=this._seasonData[g]){l=this.createSeasonItem(j,l,function(){j.stop(!0,!0).slideUp(200)}),j.append(l)}}}}},drawPart:function(){var f=0,e=$("#v_bgm_list_toggle"),h=$("#v_bgm_list_data");h.html("");f=this.episodeByAid(this._aId,this.page);this._episodeData.length<this._pageLimit?e.hide():e.show();-1==f&&(f=this._episodeData.length-1);var e=this._episodeData.length,g=this._pageLimit;lowerLimit=upperLimit=Math.min(f,e);for(f=0;f<g&&f<e;){0<lowerLimit&&(lowerLimit--,f++),f<g&&upperLimit<e&&(upperLimit++,f++)}for(f=lowerLimit;f<upperLimit;f++){if(e=this._episodeData[f]){if(-1==e.episode||"-1"==e.episode){e.episode="\u5168\u96c6"}h.append(this.createEpItem(f,e))}}},drawFull:function(e){var d=0,f=0;if(!e||0>e){e=0}$("#v_bgm_list_data").html("");this._episodeData.length>this._maxPerPage&&($("#v_bgm_list_page").show(),this._totalPage=Math.ceil(this._episodeData.length/this._maxPerPage),this.drawPagination(e));f=e*this._maxPerPage;if(e<=this._episodeData.length&&0<=f){for(e=f;e<this._episodeData.length;e++){if(d<this._maxPerPage&&(d++,f=this._episodeData[e],"object"===typeof f)){if(-1==f.episode||"-1"==f.episode){f.episode="\u5168\u96c6"}$("#v_bgm_list_data").append(this.createEpItem(e,f))}}}},createSeasonItem:function(f,e,h){var g=this;1!==this._isbangumi&&(e.title=e.season_name);f=$("<li data-id='"+e.season_id+"'>"+e.title+"</li>");f.click(function(){g._loading||($("#v_bgm_list_tab").find("li").removeClass("on"),$("#v_bgm_list_tab").find('li[data-id="'+$(this).attr("data-id")+'"]').addClass("on"),g.loadEpisode($(this).attr("data-id")),g.drawSeason($(this).attr("data-id")),"function"==typeof h&&h())});this._seasonId==e.season_id&&f.addClass("on");return f},createEpItem:function(e,d){if(1!==this._isbangumi){return this.createEpItem2(e,d)}var f=$('<a data-id="'+d.episode_id+'" idx="'+e+'" href="/video/av'+d.av_id+"/"+(1<parseInt(d.page)?"index_"+d.page+".html":"")+'">'+d.index+"</a>");d.av_id!=this._aId||parseInt(d.page)&&parseInt(d.page)!=this._page||f.addClass("active");return f},createEpItem2:function(e,d){var f=$('<a idx="'+e+'" href="/video/av'+d.aid+"/"+(1<d.page?"index_"+d.page+".html":"")+'">'+d.episode+"</a>");d.aid==this._aId&&d.page==this._page&&f.addClass("active");return f},drawPagination:function(h){var g=this,m=this._totalPage-1,l=0,k=0;$("#v_bgm_list_page").html("");for(var j=0;j<=m;j++){j==m?l=$("<a page='"+j+"'>\u7b2c"+this.episodeByIndex(j*this._maxPerPage).val.index+"-"+this.lastEpisode().index+"\u96c6</a>"):(l=this.episodeByIndex(j*this._maxPerPage).val.index,k=this.episodeByIndex(j*this._maxPerPage+(this._maxPerPage-1)).val.index,l=$("<a page='"+j+"'>\u7b2c"+l+"-"+k+"\u96c6</a>")),h==j&&l.addClass("active"),l.click(function(){g.drawFull($(this).attr("page"))}),$("#v_bgm_list_page").append(l)}},seasonByAid:function(e){var d=0,f;for(f in this._seasonData){if(this._seasonData[f].season_id==e){return d}d++}return -1},episodeByAid:function(f,e){var h=0,g;for(g in this._episodeData){if(this._episodeData[g].av_id==f&&(parseInt(1==this._episodeData[g].page)||parseInt(this._episodeData[g].page)==e)){return h}h++}return -1},episodeByIndex:function(e){var d=0,f;for(f in this._episodeData){if(d==e){if(-1==this._episodeData[f].index||"-1"==this._episodeData[f].index){this._episodeData[f].index="\u5168\u96c6"}return{key:f,val:this._episodeData[f]}}d++}return null},lastEpisode:function(){return this._episodeData[this._episodeData.length-1]},_normalize:function(e){for(var d=0;d<e.length;d++){var f=e[d];f.index=f.episode;f.av_id=f.aid;f.page=0==f.page?1:f.page}return e}};function tracksendLog(d,c){$('<script type="text/javascript" src="https://secure.bilibili.com/tracklog?url='+encodeURIComponent(d)+"&tp="+encodeURIComponent(c)+"&refer="+encodeURIComponent(document.referrer)+'">\x3c/script>').appendTo("body")}var trackTime,adCheckInt=null,isCProTrackSent=!1;function trackCProLog(){tracksendLog(document.location,"b");isCProTrackSent=!0}function trackCProTimeOver(){trackTime=new Date;clearTimeout(adCheckInt);isCProTrackSent||(adCheckInt=setTimeout(function(){clearTimeout(adCheckInt);trackCProLog()},3000))}var _ads_bindCount=0;function bindAdElement(){for(var d=document.getElementsByTagName("iframe"),c=0;c<d.length;c++){-1<d[c].src.indexOf("www.bilibili.com/bd")&&__GetCookie("DedeUserID")&&(d[c].onmousedown=trackCProLog,d[c].onmouseover=trackCProTimeOver,d[c].onactivate=trackCProLog,d[c].onclick=trackCProLog,d[c].onfocusin=d[c].onfocus=trackCProLog,d[c].contentWindow.onactivate=d[c].contentWindow.onfocusin=d[c].contentWindow.onfocus=trackCProLog,_ads_bindCount++)}d=document.getElementsByTagName("div");for(c=0;c<d.length;c++){if("comm_content"==d[c].id||"viewbox"==d[c].className||"upinfo"==d[c].className||"ad-f"==d[c].className||"bottom"==d[c].className||"tagcontainer"==d[c].className||"scontent"==d[c].className){d[c].onmouseover=function(){null==adCheckInt||50>(new Date).getTime()-trackTime.getTime()||(clearTimeout(adCheckInt),adCheckInt=null)}}}$("body").mouseover(function(){null==adCheckInt||50>(new Date).getTime()-trackTime.getTime()||(clearTimeout(adCheckInt),adCheckInt=null)})}function getBasicHighCharts(d,c){d.chart.renderTo=c;d.subtitle={text:void 0===document.ontouchstart?"Click and drag in the plot area to zoom in":"Drag your finger over the plot to zoom in"};return d}function goQuote(){var d=$(".quote"),c=d.offset();$("html,body").animate({scrollTop:c.top-80},300);d.delay(300);for(i=0;3>i;i++){d.animate({borderColor:"#00a1d6"},250),d.animate({borderColor:"#efefef"},250)}}function miniPlayer(){var u=$("#bofqi");if((0<u.find("iframe").length||0<u.find("embed").length&&0<=u.find("embed").attr("src").indexOf("play.swf")||0<u.find("#player_placeholder").length)&&0==$("#sponsor_list").length&&$(".v_small").length){var t=u.offset().top+u.height()+100,s=0,r=!1,q=1==localStorage.getItem("b_miniplayer")||null==localStorage.getItem("b_miniplayer")?$('<div id="miniPlayerSwitch" status="1" title="\u70b9\u51fb\u5173\u95ed\u8ff7\u4f60\u64ad\u653e\u5668">mini</br>ON</div>').appendTo("#index_nav"):$('<div id="miniPlayerSwitch" status="0" title="\u70b9\u51fb\u6253\u5f00\u8ff7\u4f60\u64ad\u653e\u5668">mini</br>OFF</div>').appendTo("#index_nav"),p=$("#checkbox_miniplayer"),o=null;1!=ChatGetSettings("b_miniplayer")&&null!=ChatGetSettings("b_miniplayer")||p.attr("status",!0);q.click(function(){var a=$(this);1==parseInt(a.attr("status"))?(r=!0,l(),q.html("mini</br>OFF").attr("title","\u70b9\u51fb\u6253\u5f00\u8ff7\u4f60\u64ad\u653e\u5668"),a.attr("status",0),rec_rp("event","miniplay_close"),ChatSaveSettings("b_miniplayer",0),utils.customReport("playpage_miniplay_close")):(t==u.offset().top+u.height()+100||u.hasClass("newfloat")||(t=u.offset().top+u.height()+100),$(window).scrollTop()>t&&(r=!1,n()),q.html("mini</br>ON").attr("title","\u70b9\u51fb\u5173\u95ed\u8ff7\u4f60\u64ad\u653e\u5668"),a.attr("status",1),ChatSaveSettings("b_miniplayer",1),rec_rp("event","miniplay_open"),utils.customReport("playpage_miniplay_open"))});var n=function(){if(!u.hasClass("newfloat")&&!r&&0!=$(".comm").find("ul").length){var a=$('<div class="b-player-dummy"></div>').insertBefore(u);u.hasClass("wide")&&a.addClass("wide");$('<div class="move"><div class="t" title="\u70b9\u51fb\u6309\u4f4f\u62d6\u52a8"></div><div class="close"></div></div>').prependTo(u);0<$(".huodong_bg").length&&$(".huodong_bg").hide();u.addClass("newfloat").stop().animate({opacity:1},300);o?u.css(o):(a=0<$(".rat").length?$(".rat").offset().left:$(".v_small").offset().left,u.css({left:a,opacity:0}),860>=$(window).height()&&u.css({top:"inherit",bottom:"160px"}));$(window).trigger("scroll")}},l=function(){j();$(".move",u).remove();$(".b-player-dummy").remove();u.removeClass("newfloat");u.css({left:"",top:"",bottom:""});0<$(".huodong_bg").length&&$(".huodong_bg").show()},j=function(){s=0;$(".mmask").remove();$(document).unbind("mousemove");$("body,#bofqi").removeClass("noselect");$(".move",u).removeClass("on")};$(document).on("scroll.miniplayer",function(){0!=ChatGetSettings("b_miniplayer")&&(t==u.offset().top+u.height()+100||u.hasClass("newfloat")||(t=u.offset().top+u.height()+100),$(window).scrollTop()>t?n():(r&&(r=!1),u.hasClass("newfloat")&&l()))});u.hover(function(){u.hasClass("newfloat")&&!s&&$(".move",u).show()},function(){s||$(".move",u).hide()});$(u).delegate(".move","mousedown",function(a){s=1;$("body,#bofqi").addClass("noselect");$(this).addClass("on");$('<div class="mmask"></div>').appendTo("body");var f=a.pageX-$(this).offset().left,c=a.pageY-$(this).offset().top;$(document).bind("mousemove",function(d){var g=d.clientX-f,e=d.clientY-c<=$(window).height()-u.height()?d.clientY-c:$(window).height()-u.height(),g=d.clientX-f>=$(window).width()-u.width()-5?$(window).width()-u.width()-5:5>=d.clientX-f?5:d.clientX-f,e=d.clientY-c>=$(window).height()-u.height()-5?$(window).height()-u.height()-5:0>=d.clientY-c?0:d.clientY-c;o={left:g,top:e};u.css(o)})});$(u).delegate(".move","mouseup",function(b){j()});$(u).delegate(".move .close","click",function(b){r=!0;l()});$(u).delegate(".move .gotop","click",function(b){$("html,body").animate({scrollTop:$(".viewbox").offset().top},300)})}}function rateFrm(h){function g(d){var c=$(".block.coin").find(">span");$(".block.coin").find(".t-right-bottom");UserStatus.isLogin(c)&&(1>UserStatus.level()?(new MessageBox(m)).show(c,"\u7b49\u7ea7\u4e0d\u8db3LV1\uff0c\u65e0\u6cd5\u6295\u786c\u5e01",1500):l.show(d))}var m={focusShowPos:"up"};$(".block.coin").show();$(".block.coin").off("click").click(function(){g(this);utils.customReport("playpage_coinbtn2")});GNS.playerCallSendCoin=function(){g(!0)};window.playerCallSendCoin=function(){g(!0)};var l=new coinPanel;l.btn.push($(".block.coin"));l.sended=function(){var b=$(".v-title-line.coin_btn").off("mouseenter.anim");b.find("i.b-icon").css("background-position"," -2340px -60px");b.stop();$(".b-icon-anim-coin").addClass("on").css("background-position","0px -80px");$(".block.coin .t-right-top").text("\u5df2\u6295\u5e01")};l.successCallback.push(function(x){var w=$(".block.coin .v_ctimes").text();/\u4e07/.test(w)||$(".v-title-line.coin_btn #v_ctimes ,.block.coin .v_ctimes").text(utils.formatNum(parseInt(w)+x));if(x=$(".v-title-line.coin_btn i.b-icon").data("animCoin")){x.options=$.extend(x.options,{element:$(".v-title-line.coin_btn").find("i.b-icon"),frameSource:"//static.hdslb.com/images/base/anim-coin-small.png",frameWidth:60,frameHeight:60,offsetY:60,fps:24,totalFrame:40}),x.start()}$(".v-title-line.coin_btn").off("mouseenter.anim").off("mouseleave.anim");$(".b-icon-anim-coin").addClass("on").css("background-position","0px -80px");$(".block.coin .t-right-top").text("\u5df2\u6295\u5e01");if(mid&&window.AttentionList){if(0>AttentionList.indexOf(parseInt(mid))){var v=$('<div class="m-layer" style="width: 340px; height: 120px; text-align: center;position: fixed;top: 50%;left: 50%;margin-left: -170px;margin-top: -60px;"><div style="padding: 30px 0 15px 0; height: 20px; line-height: 20px; font-size: 16px;">\u6295\u5e01\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u652f\u6301</div><div><a class="attention-btn" style="display: inline-block; width: 48px; height: 24px; line-height: 24px; margin-right: 5px; background: #00a1d6; color: #fff; border-radius: 4px;">\u5173\u6ce8</a>UP\u4e3b, \u53ca\u65f6\u4e86\u89e3TA\u7684\u6700\u65b0\u4f5c\u54c1~</div><div style="position: absolute; height: 28px; line-height: 28px; width: 70px; right: 10px; top: 10px; background: #6f6f6f; color: #fff; cursor: pointer; border-radius: 4px; font-size: 12px;" class="close-btn">\u5173\u95ed <span>( </span><span class="attention-count">6</span><span> )</span></div></div>');$("body").append(v);var u=v.find(".attention-btn"),o=v.find(".close-btn"),d=v.find(".attention-count");$(".block.coin").offset();var t=6,s;u.on("click.attention",function(){$(".r-info > .f").trigger("click");v.remove()});u.hover(function(){$(this).css("background-color","#00b5e5")},function(){$(this).css("background-color","#00a1d6")});var c=function(){t--;0===t?(clearTimeout(s),u.off(),v.remove()):(d.text(t),s=setTimeout(c,1000))};s=setTimeout(c,1000);o.hover(function(){$(this).css("background-color","#888")},function(){$(this).css("background-color","#6f6f6f")});o.on("click",function(){clearTimeout(s);u.off();o.off();v.remove()})}else{(new MessageBox(m)).show($(".coin-sure.b-btn"),"\u6295\u5e01\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u652f\u6301",1500)}}l.soldOut()});l.fall=function(b){(new MessageBox(m)).show($(".coin-sure.b-btn"),b,1500)};var k=$(".v-title-line.coin_btn");h=k.find("i.b-icon");var j=new Animator({element:h,frameSource:"//static.hdslb.com/images/base/anim-coin-small.png",frameWidth:60,frameHeight:60,fps:24,totalFrame:19});h.data("animCoin",j);k.on("mouseenter.anim",function(){j.start(1)}).on("mouseleave.anim",function(){j.back()}).click(function(){g(k);utils.customReport("playpage_coinbtn1")});l.btn.push($(k))}var coinPanel=function(b){this.successCallback=[];this.fall=function(){};this.spending=0;this.init();this.btn=[]};coinPanel.prototype={init:function(){if(UserStatus.isLogin()){var b=this;b.type=$(".block.coin").attr("arctype");$.ajax({url:"//api.bilibili.com/x/web-interface/archive/coins",type:"get",dataType:"jsonp",data:{jsonp:"jsonp",aid:window.aid},success:function(a){b.spending=a&&a.data&&a.data.multiply;b.soldOut()}})}},show:function(d){var c=this;"Original"==c.type&&2==c.spending||"Copy"==c.type&&1==c.spending||(utils.lockPageScroll("lock"),c.$mask=$('<div class="wnd-mask"></div>'),c.$wrap=$('<div class="coin-wrap"></div>'),c.$content=$('<div class="coin-content"><i class="b-icon b-icon-a b-icon-close"></i><p class="coin-title">'+("Original"==c.type?"\u7ed9UP\u4e3b\u6295\u4e0a":"\u7ed9\u89c6\u9891\u6295\u4e0a")+'<i></i>\u679a\u786c\u5e01</p><div class="coin-nav"></div><a class="coin-sure b-btn" href="javascript:void(0)">\u786e\u5b9a</a><p class="coin-tips">\u7ecf\u9a8c\u503c+<i></i>( \u4eca\u65e5<i></i>/50)</p></div>'),c.getTips(),c.checkbox(),c.$wrap.append(c.$content),c.$wrap.append('<iframe class="layout"></iframe>'),$(".b-icon-close",c.$content).click(function(){c.close()}),$(".coin-sure",c.$content).click(function(){c.send()}),$("body").append(c.$mask),$("body").append(c.$wrap),setTimeout(function(){c.$wrap.addClass("fade-in")},0))},send:function(){var b=this;$.ajax({url:"/plus/comment.php",type:"post",data:{aid:window.aid,rating:100,player:1,multiply:b.tip},success:function(a){"OK"==a?b.success(b.tip):b.fall(a);b.close()}})},getTips:function(){var d=this;d.$tips=$(".coin-tips",d.$content);if(d.usedCoinCache){var c=d.usedCoinCache.number;50>c?d.$tips.addClass("on").html("\u7ecf\u9a8c\u503c+<i>"+d.tip+"0</i>\uff08\u4eca\u65e5<i>"+c+"</i>/50\uff09"):d.$tips.addClass("on").html("\u4eca\u65e5\u6295\u5e01+50\u7ecf\u9a8c\u6210\u5c31 get\u221a \u8d5e\uff01")}else{$.ajax({url:"//www.bilibili.com/plus/account/exp.php",type:"get",dataType:"json",success:function(a){d.usedCoinCache=a;d.getTips()}})}},checkbox:function(){var f,e=this;e.$checkbox=$(".coin-nav",e.$content);var h=[{on:"//static.hdslb.com/images/coin/22.gif",off:"//static.hdslb.com/images/coin/22-gray.png"},{on:"//static.hdslb.com/images/coin/33.gif",off:"//static.hdslb.com/images/coin/33-gray.png"}];if("Original"!=e.type||e.spending){e.tip=1,f=$('<div class="coin-checkbox on"><p class="lable">1\u786c\u5e01</p><img class="" src="'+h[0].on+'"></div>')}else{e.tip=2;$("<img />").attr("src",h[0].on);$("<img />").attr("src",h[1].off);$("<img />").attr("src","//static.hdslb.com/images/coin/border-hover.png");f=$("<div/>");var g=[$('<div class="coin-checkbox margin"><p class="lable">1\u786c\u5e01</p><img class="" src="'+h[0].off+'"></div>'),$('<div class="coin-checkbox on"><p class="lable">2\u786c\u5e01</p><img class="" src="'+h[1].on+'"></div>')];f.append(g[0],g[1]);$(g).map(function(b,d){var c=$(d);c.click(function(){if(!c.hasClass("on")){e.tip=1+b;var j,a;e.pay=b;c.addClass("on");0===b?a=1:1===b&&(a=0);j=g[a];j.removeClass("on");$("img",c).attr("src",h[b].on);$("img",j).attr("src",h[a].off);$(".coin-title i",e.$content).html(e.tip);50>e.usedCoinCache.number&&e.$tips.addClass("on").html("\u7ecf\u9a8c\u503c+<i>"+e.tip+"0</i>\uff08\u4eca\u65e5<i>"+e.usedCoinCache.number+"</i>/50\uff09")}})})}$(".coin-title i",e.$content).html(e.tip);e.$checkbox.append(f);return f},success:function(){var b=this.successCallback;this.spending+=this.tip;this.usedCoinCache.number+=10*this.tip;this.getTips();for(i in this.successCallback){if(b.hasOwnProperty(i)&&"function"==typeof b[i]){b[i](this.tip)}}},soldOut:function(){("Original"==this.type&&2==this.spending||"Copy"==this.type&&1==this.spending)&&$.each(this.btn,function(d,c){$(c).attr("title","\u5bf9\u672c\u7a3f\u4ef6\u7684\u6295\u5e01\u679a\u6570\u5df2\u7528\u5b8c").click(function(){(new MessageBox).show($(this),"\u5bf9\u672c\u7a3f\u4ef6\u7684\u6295\u5e01\u679a\u6570\u5df2\u7528\u5b8c",1500)})});this.spending&&this.sended()},close:function(){utils.lockPageScroll("unlock");this.$wrap.remove();this.$mask.remove()}};function _rateComplete(f,e){e=e||1;var h=$('<div class="plus-num">+'+e+"</div>"),g=parseInt(f.html())||0;f.html(g+e);h.appendTo(f).animate({bottom:"70px"},300,function(){h.fadeOut(100,function(){h.remove()})})}function OnBpRankList(b){onLoginInfoLoaded(function(a){createBpRankList(b)})}$(document).ready(function(){$("#sponsor_list").length&&OnBpRankList()});function createBpRankList(s){function r(h,g){var v,u=!1;0!=h.uid?v=$('<li class="clearfix"><div class="rank-item"><div class="rank-num">'+g+'</div><a href="//space.bilibili.com/'+h.uid+'" card="'+h.uname+'" target="_blank"><div class="face"><img src="'+utils.thumbnail(h.face,36)+'" /></div></a></div></li>'):(u=!0,v=$('<li class="clearfix"><div class="rank-item"><div class="rank-num">'+g+'</div><div class="face"><img src="'+utils.trimHttp(h.face)+'" /></div></div></li>'));var t=$('<div class="detail"></div>').appendTo(v.find(".rank-item")),k=$('<div class="name">'+h.uname+"</div>");u||(k=$('<a href="//space.bilibili.com/'+h.uid+'" card="'+h.uname+'" target="_blank"></a>').append(k));k.prependTo(t);3>=g&&(v.addClass("top n"+g),v.find(".rank-num").addClass("n"+g),h.message?t.append('<div class="msg">'+h.message+"</div>"):t.append('<div class="msg">TA\u6ca1\u6709\u7559\u8a00</div>'),t.find(".msg").append('<div class="arrow"></div>'));return v}function q(c,g){if(c){o.empty();for(var f=!1,b=0;b<c.length;b++){var h=c[b],e=r(h,h.rank).appendTo(o);h.uid==window.uid&&(e.addClass("mine"),f=!0)}g.mine&&!f&&(e=r({uid:window.uid,uname:window.biliLoginStatus.uname,face:window.biliLoginStatus.face},g.mine.rank).addClass("mine").appendTo(o));j.empty();pagelist(j,l+1,m,g.list.list.length,function(d){l=d-1;q(n[l],g)},"",2);j.find(".result,.indexPage,.endPage").remove();bindCardEvent(o)}}var p=$("#sponsor_list"),o=p.find("ul"),n=[],m=0,l=0,j=$('<div class="pagelistbox small"></div>');$.getJSON("/widget/ajaxGetBP?aid="+window.aid,function(h){l=0;var g=$(".bangumi-buybuybuy"),d=h.users||0;g.find(".total b").html(d);if(h.list&&0==h.list.code){var f=h.list.list;m=Math.ceil(f.length/10);for(var e=f.length,c=0;c<m;c++){for(var w=[],k=10*(c+1)>e?e:10*(c+1),v=10*c;v<k;v++){w.push(f[v])}n.push(w)}10<h.list.list.length&&(p.find(".pagelistbox").length?j=p.find(".pagelistbox"):j.insertAfter(o));q(n[l],h)}h.mine&&(g.addClass("done"),f=window.biliLoginStatus.face,null!=f.match("_s")&&f.replace("_s","_m"),g.find(".b-btn.buy").addClass("done").html("\u6211\u627f\u5305\u4e86\u8fd9\u96c6<b>"+h.mine.count+"</b>B\u5e01"));p.find(".list-total .total").html(d+"<div>\u627f\u5305\u5546\u4eba\u6570</div>");0==h.list.list.length&&o.append('<li class="no-sponsor">\u6682\u65f6\u6ca1\u6709\u627f\u5305\u5546( >\ufe4f<\u3002)\uff5e</li>');h=h.percent;animateCss=60<=h?"animate green":40<=h?"animate yellow":20<=h?"animate orange":"animate red"}).error(function(){o.append('<li class="no-sponsor">\u52a0\u8f7d\u5931\u8d25</li>')})}function createBatteryRankList(s,r){function q(h){j.empty();for(var g=0;g<h.length;g++){var v=h[g],u=v.rank,t=void 0,k="";v.is_anonymity?(k="\u533f\u540d\u7528\u6237",t=$('<li class="clearfix"><div class="rank-item"><div class="rank-num">'+u+'</div><div class="face"><img src="//static.hdslb.com/images/hidden.png" /></div></div></li>')):(k=v.name,t=$('<li mid="'+v.mid+'" class="clearfix"><div class="rank-item"><div class="rank-num">'+u+'</div><a href="//space.bilibili.com/'+v.mid+'" card="'+k+'" target="_blank"><div class="face"><img src="'+utils.trimHttp(v.face)+'" /></div></a></div></li>'));$('<div class="name">'+k+"</div>").insertAfter(t.find(".face"));3>=u&&t.find(".rank-num").addClass("n n"+u).html("");t.attr("rank",u);u=t.appendTo(j);v.mid==window.uid&&u.addClass("mine").find(".rank-num").html("\u6211")}bindCardEvent(j)}function p(e){var c,h;if(e.code){j.append('<li class="no-data">\u52a0\u8f7d\u5931\u8d25</li>'),n.removeClass("loading").append('<div class="error">\u52a0\u8f7d\u5931\u8d25</div>')}else{if(e.rankList&&e.rankList.result){c=e.rankList.result;for(var f=0;f<c.length;f++){c[f].mid==window.uid&&(c[f].face=c[f].face||biliLoginStatus.face,c[f].name=c[f].name||biliLoginStatus.uname)}h=e.rankList.total_feed_user;q(c)}else{c=[],h=0,j.append('<li class="no-data">\u6682\u65f6\u6ca1\u6709\u4eba\u5145\u7535( >\ufe4f<\u3002)\uff5e</li>')}0==h?l.find(".hd-txt").html("UP\u4e3b\u80fd\u91cf\u4e0d\u8db3"):l.find(".hd-txt").html('\u5171 <b class="total-num">'+h+"</b> \u4eba\u63d0\u4f9b\u4e86\u80fd\u91cf");var k=setInterval(function(){if("undefined"!=typeof EnergyPool){clearInterval(k);n.removeClass("loading").empty();var b="undefined"!=typeof document.createElement("canvas").getContext("2d")?"canvas":"div";(new EnergyPool("#energy_pool_container",{uid:window.uid,mode:b,width:270,height:118,data:c,total:h,create:function(d){o.find(".pipe").css("background-color",d.colorLevel.pool);l.css("background-color",d.colorLevel.pool);l.find("#rank_btn_feed").addClass(d.colorLevel.level).css("background-color",d.colorLevel.btn)}})).init()}},100)}}var o=$(".energy-pool"),n=null;0==o.length?(o=$('<div class="energy-pool"><div class="pool-hd"><div class="up-face"><a href="//space.bilibili.com/'+r.uid+'" target="_blank"><img src="'+utils.trimHttp(r.face)+'" /></a></div><span class="t">'+r.nick+'\u7684\u80fd\u91cf\u6c60</span></div><div id="energy_pool_container"></div><div class="pipe"></div></div>').appendTo(".v_small"),$('<script type="text/javascript" src="//static.hdslb.com/battery/js/energy.js">\x3c/script>').appendTo("head"),n=$("#energy_pool_container").addClass("loading")):n=$("#energy_pool_container").addClass("loading").empty();var m=$("#battery_ranking").empty();0==m.length&&(m=$("<div>").addClass("battery-ranking").attr("id","battery_ranking").appendTo(".v_small"));var l=$('<div class="list-head"><span class="hd-ico"></span><span class="hd-txt"></span><div id="rank_btn_feed" class="bangumi-btn">\u6211\u6765\u63d0\u4f9b\u80fd\u91cf</div></div>').appendTo(m),m=$("<div>").addClass("list-wrp clearfix").appendTo(m),j=$("<ul>").appendTo(m);"object"!=typeof s?$.ajax({url:"//prop.bilibili.com/api/electric/query.rank.list",data:{mid:window.uid,aid:r.aid,top:10,captcha:window.captcha_key},dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(b){p(b);b.code||(window.fb=new bbFeedbackPlugIn(".bp_comment",b,r),fb.show(r.aid,1))},error:function(){j.append('<li class="no-data">\u52a0\u8f7d\u5931\u8d25</li>');n.removeClass("loading").append('<div class="error">\u52a0\u8f7d\u5931\u8d25</div>')}}):p(s)}function initToolBar(){if(0!=$(".arc-toolbar, .arc-tool-bar").length){for(var w=$("#app_qrcode_box"),v={},u=[{name:"share",totalFrame:17},{name:"fav",totalFrame:14,loopFrame:1},{name:"app",totalFrame:16,loopFrame:10},{name:"watch-later",totalFrame:12,loopFrame:1},{name:"coin",totalFrame:7,loopFrame:1}],t=$(".arc-toolbar"),s=0;s<u.length;s++){(function(b){var h=$("."+b.name,t),g=$(".b-icon-anim-"+b.name,h),d="undefined"!=typeof b.loopFrame?b.loopFrame:void 0;v[b.name]=new Animator({element:g,frameSource:"//static.hdslb.com/images/base/anim-"+b.name+".png",frameWidth:80,frameHeight:80,fps:10,totalFrame:b.totalFrame});h.mouseenter(function(){if(!g.length){return !1}if(g.hasClass("on")){return v[b.name].stop(),!1}v[b.name].start(d)}).mouseleave(function(){v[b.name].back()})})(u[s])}var r=w.find(".qr-code-box"),q=null;0<r.length&&(u=$("#qr_code"),s={width:100,height:100,typeNumber:-1,correctLevel:0,background:"#fff",foreground:"#000",text:location.href},"undefined"!=typeof document.createElement("canvas").getContext?s.render="canvas":s.render="table",u.empty().qrcode(s).data("qrcode",s),w.addClass("initialized").hover(function(){clearTimeout(q);q=setTimeout(function(){r.stop(!0,!0).slideDown(200);utils.customReport("playpage_mobileshow")},300)},function(){clearTimeout(q);r.stop(!0,!0).slideUp(200)}));var o=$(".block.share").addClass("initialized");$(".t-right-bottom",o).on("change",function(b){console.log(b)});$(".block",t);var n=$(".share-tool-bar,.block.share"),l=2;$(".t-right-bottom",o).on("DOMNodeInserted",function(b){l--?$(".drawer .num",n).text($(this).text()):$(".t-right-bottom",o).off("DOMNodeInserted")});var j=$(".share-box",n);n.hover(function(){clearTimeout(q);q=setTimeout(function(){j.stop(!0,!0).slideDown(200,function(){});utils.customReport("playpage_share")},300)},function(){clearTimeout(q);j.stop(!0,!0).slideUp(200)});onLoginInfoLoaded(function(b){rateFrm(b)});"undefined"!=typeof wb_url&&bindShare({url:wb_url,title:wb_info&&$(".v-title h1").text(),desc:"undefined"!=typeof wb_desc?wb_desc:"",summary:"undefined"!=typeof wb_summary?wb_summary:"",shortTitle:"undefined"!=typeof wb_title?wb_title:wb_info,weiboTag:"#\u54d4\u54e9\u54d4\u54e9\u52a8\u753b#"})}}var ShareModule={shared:!1,openShareWindow:function(f,e){var h=[],g;for(g in e){null!=e[g]&&h.push(g+"="+encodeURIComponent(e[g]))}h=f+h.join("&");window.open(h,"","width=760, height=640, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no");return !1},bind:function(g,f){var k=this;f=f||"#share_list .share-btn,.share-btn-bar .g-share-btn";g=$.extend(!0,{title:document.title,url:location.href,desc:"",pic:"",summary:"",shortTitle:"",searchPic:!1,appkey:{weibo:"2841902482",qqweibo:"84435a83a11c484881aba8548c6e7340"},weiboTag:"",twitterTag:"",aid:window.aid,tp_id:window.tp_id},g);$(f).click(function(a){var m=$(this),l=m.attr("id")||m.attr("data-id");if("btn_weixin"!=l){k.addShare(g)}else{if(!m.attr("id")){a.stopPropagation();var c=m.find(".share-weixin");c.length||(c=$('<div class="share-weixin"><div class="qr-code"></div><p>\u7528\u5fae\u4fe1\u626b\u4e00\u626b</p></div>').appendTo(m).hide(),a={width:100,height:100,typeNumber:-1,correctLevel:0,background:"#fff",foreground:"#000",text:location.href},"undefined"!=typeof document.createElement("canvas").getContext?a.render="canvas":a.render="table",c.find(".qr-code").qrcode(a));c.is(":visible")?c.stop(!1,!0).slideUp(200):c.stop(!1,!0).slideDown(200);$("body").off("click.v-weixin-share");$("body").on("click.v-weixin-share",function(){c.stop(!1,!0).slideUp(200);$("body").off("click.v-weixin-share")})}}switch(l){case"btn_weibo":k.openShareWindow("http://service.weibo.com/share/share.php?",{url:g.url,type:"3",count:"1",appkey:g.appkey.weibo,title:g.title+g.weiboTag,pic:g.pic,searchPic:g.searchPic,ralateUid:"",language:"zh_cn",rnd:(new Date).valueOf()});rec_rp("event","arc_share_weibo");utils.customReport("playpage_share_weibo");break;case"btn_qqweibo":k.openShareWindow("http://v.t.qq.com/share/share.php?",{title:g.title,url:g.url,appkey:g.appkey.qqweibo,site:"//www.bilibili.com/",assname:"bilibiliweb",pic:g.pic});break;case"btn_qqzone":k.openShareWindow("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",{url:g.url,showcount:1,desc:g.desc,summary:g.summary,title:g.shortTitle,site:"\u54d4\u54e9\u54d4\u54e9",pics:g.pic,style:"203",width:98,height:22});rec_rp("event","arc_share_qqzone");utils.customReport("playpage_share_qzone");break;case"btn_baidu":k.openShareWindow("http://tieba.baidu.com/f/commit/share/openShareApi?",{title:g.title,url:g.url,uid:726865,to:"tieba",type:"text",relateUid:"",pic:g.pic,key:"",sign:"on",desc:"",comment:g.desc});rec_rp("event","arc_share_baidu");utils.customReport("playpage_share_tieba");break;case"btn_twitter":k.openShareWindow("https://twitter.com/intent/tweet?",{text:g.desc||g.title,hashtags:g.twitterTag,url:g.url});break;case"btn_facebook":k.openShareWindow("https://www.facebook.com/share.php?",{src:"",u:g.url});break;case"btn_qq":k.openShareWindow("http://connect.qq.com/widget/shareqq/index.html?",{url:g.url,desc:g.desc,title:g.title,summary:g.summary,pics:g.pic,flash:"",site:"",style:"201",width:32,height:32}),rec_rp("event","arc_share_qq"),utils.customReport("playpage_share_qq")}});var j=$(".share-weixin");0==j.length&&(j=$('<div class="share-weixin"><div class="qr-code"></div></div>').appendTo($("#btn_weixin")));var h={width:150,height:150,typeNumber:-1,correctLevel:0,background:"#fff",foreground:"#000",text:location.href};h.width=h.height=110;$("#share_list").find(".share-right .share-head").html("\u5fae\u4fe1\u626b\u4e00\u626b\u5206\u4eab");j.find(".qr-code").css("height","110px");"undefined"!=typeof document.createElement("canvas").getContext?h.render="canvas":h.render="table";$.fn.qrcode?j.find(".qr-code").qrcode(h).data("qrcode",h):RequireModule.getScript("js/jquery.qrcode.min.js",function(){j.find(".qr-code").qrcode(h).data("qrcode",h)});$(".address-copy").click(function(){copy_clip($(this).prev());(new MessageBox).show($(this),"\u5df2\u6210\u529f\u590d\u5236\u5230\u526a\u5207\u677f");"video_address"==$(this).prev().attr("name")&&utils.customReport("playpage_share_video");"flash_address"==$(this).prev().attr("name")&&utils.customReport("playpage_share_flash");"html_address"==$(this).prev().attr("name")&&utils.customReport("playpage_share_html")});return{getParams:function(a){return g[a]},setParams:function(a,d){g.hasOwnProperty(a)&&(g[a]=d)}}},app:{defaultParams:{type:"image",url:location.href,title:document.title,image_url:"",text:""},shareDataStr:null,set:function(b){b=$.extend(!0,this.defaultParams,b);b=JSON.stringify(b);window.biliios?window.biliios.setShareContext(b):window.biliandroid&&window.biliandroid.setShareContext?window.biliandroid.setShareContext(b):window.biliandroid&&window.biliandroid.setShareContent&&window.biliandroid.setShareContent(b);return this.shareDataStr=b},show:function(){window.biliios?window.biliios.showShareWindow(this.shareDataStr||JSON.stringify(this.defaultParams)):window.biliandroid&&window.biliandroid.showShareWindow(this.shareDataStr||JSON.stringify(this.defaultParams))}},addShare:function(e){var d=this;e=$.extend(!0,{aid:window.aid,tp_id:window.tp_id},e);if(!d.shared&&(e.aid||e.tp_id)){var f;if(e.aid){f=0,e=e.aid}else{if(e.tp_id){f=3,e=e.tp_id}else{return !1}}$.ajax({url:"//api.bilibili.com/x/share/add",type:"post",data:{type:f,id:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0},dataType:"json",success:function(b){if(b&&0==b.code){d.shared=!0;var k=$(".block.share .t-right-bottom,.share-tool-bar .num"),j=$('<div class="plus-num">+1</div>'),h=parseInt(k.html())>>0;h<b.data>>0&&(k.html(h+1),j.appendTo(k).animate({bottom:"70px"},300,function(){j.fadeOut(100,function(){j.remove()})}))}}})}}};window.bindShare=function(){return ShareModule.bind.apply(ShareModule,arguments)};function onPlayerScriptJump(e,d,f){e="//www.bilibili.com/video/"+e;d&&1!=parseInt(d)&&(e+="#page="+d);f?window.open(e,"_blank"):location.href=e}var lazyImage=new LazyImage,RecommendArea=function(){function f(b,d){$.getJSON(d,function(a){b.find(".b-loading").remove();a&&0==a.code?a&&0==a.code&&((a=a.data)&&a.length?e(b,a):$(".recommend-area").remove()):$(".recommend-area").remove()})}function e(d,c){if(c){for(var m=0;m<c.length;m++){g(c[m]).appendTo(d)}d.width(c.length*d.children().outerWidth(!0));d.data("left",0);var l=$('<div class="page prev no-select"><span class="icon"></span></div>').insertAfter(d).hide().on("click",function(){h(d,-1);utils.customReport("playpage_recommend_switch")}),j=$('<div class="page next no-select"><span class="icon"></span></div>').insertAfter(d).on("click",function(){h(d,1);utils.customReport("playpage_recommend_switch")});d.parent().hover(function(){d.width()>d.parent().width()&&(d.parent().find(".page.prev").show(),d.parent().find(".page.next").show())},function(){l.hide();j.hide()});lazyImage.lazy(d)}}function h(k,j){var m=870==k.parent().width()?5:4,l=k.data("left")+j*k.children().outerWidth(!0)*m;0>l?l=0!=k.data("left")?0:k.children().length%m?k.width()-k.children().length%m*k.children().outerWidth(!0):k.width()+l:l>=k.width()&&(l=0);k.css({"margin-left":-l,opacity:0}).stop(!0,!0).animate({opacity:1},200);k.data("left",l);lazyImage.lazy(k);return l}function g(d){var c=$('<li><div class="v"><a class="preview" href="/video/av'+d.aid+'/" target="_blank" title="'+d.title+'"><div class="medal"></div><div class="original"></div><div class="border"></div><img data-img="'+d.pic+'" data-alt="'+d.title+'"></a><i class="watch-later" aid='+d.aid+'></i><a href="/video/av'+d.aid+'/" target="_blank" title="'+d.title+'"><div class="t">'+d.title+"</div></a></div></li>");$('<div class="i"><span><i class="b-icon b-icon-v-play"></i>'+utils.formatNum(d.stat.view)+'</span><span><i class="b-icon b-icon-v-dm"></i>'+utils.formatNum(d.stat.danmaku)+"</span></div>").insertAfter(c.find(".t"));d.badgepay&&$('<div class="rm-pay">\u4ed8\u8d39\u89c2\u770b</div>').prependTo(c.find(".preview"));return c}return{create:function(){$(".recommend-area").remove();var a=$('<div class="recommend-area report-scroll-module" id="recommend_report"><div class="b-head"><span class="b-head-t">\u770b\u8fc7\u8be5\u89c6\u9891\u7684\u8fd8\u559c\u6b22</span></div><div class="rm-list-wrp"><ul class="rm-list"><div class="b-loading"></div></ul></div></div>').insertBefore(".v_large .common");f(a.find(".rm-list"),"//comment.bilibili.com/recommendnew,"+window.aid);return a}}}(),LiveRecommendList=function(){var b='<div class="v-live-recommend"><div class="b-head"><span class="b-head-t">\u5927\u5bb6\u56f4\u89c2\u7684\u76f4\u64ad</span></div><ul class="v-list-live"></ul></div>';return{create:function(){var a=window.topid||$(".nav-menu .m-i.on").attr("data-tid"),f=window.typeid,e;!a||0>$.inArray(parseInt(a),window.tidSet)||(window.liveRecommendXhrDone=function(c){if(0==c.code&&c.data){if($.isArray(c.data)){if(!c.data.length){return}e=c.data[Math.floor(Math.random()*c.data.length)]}else{e=c.data}$(".bangumi-content .ad").length&&$(".bangumi-content").removeClass("v_large");b=$(b).appendTo(".v_small");$('<li><div class="lv-item"><a class="lv-preview" href="'+utils.trimHttp(e.link)+'" target="_blank" title="'+e.title+'"><img data-img="'+e.pic+'" alt="'+e.title+'" /><div class="lv-mask"></div><div class="b-icon-live-play"><i class="lv-onair-dot"></i><span class="lv-onair-txt">LIVE</span></div></a><a href="'+utils.trimHttp(e.link)+'" target="_blank"><div class="lv-room"><div class="lv-face"><img data-img="'+utils.trimHttp(e.face)+'"></div><div class="lv-t" title="'+e.title+'">'+e.title+'</div></div><div class="lv-info"><div class="lv-host" title="'+e.uname+'"><i class="b-icon b-icon-live-host"></i>'+e.uname+'</div><div class="lv-online"><i class="b-icon b-icon-live-online"></i>'+utils.formatNum(e.online)+"</div></div></a></div></li>").appendTo(b.find(".v-list-live"));lazyImage.lazy(b)}},$.ajax({url:"//api.live.bilibili.com/bili/LiveRecommend?id="+a+"&tid="+f,dataType:"jsonp",jsonpCallback:"liveRecommendXhrDone",cache:!0}))}}}();(function(){function d(b){this.numChangeList=[];this.APIConfig={base:"//api.bilibili.com",list:{list:"/x/v2/fav/folder",create:"/x/v2/fav/folder/add",add:"/x/v2/fav/video/add",del:"/x/v2/fav/video/del","default":"/x/v2/fav/video/favoured"}};this.options=$.extend(!0,{stowed:!1,aid:null,onAdd:function(){},onDel:function(){},onCreate:function(){}},b);this.template='<div class="fav-wnd" id="fav_wnd"><div class="fav-hd">\u6dfb\u52a0\u5230\u6536\u85cf\u5939<i class="b-icon b-icon-a b-icon-close"></i></div><div class="fav-bd"><div class="fav-mask"></div><div class="fav-tip"></div><div class="fav-list-wrp"><ul class="fav-list"><li class="loading">loading...</li></ul><div class="fav-new-placeholder"><span class="fav-icon-add"></span><span class="txt">\u65b0\u5efa\u6536\u85cf\u5939</span></div><div class="fav-new-wrp">'+(c?"":'<div class="fav-add-tip">\u70b9\u51fb\u5f39\u7a97\u5185\u5176\u4ed6\u533a\u57df\u6216ESC\u952e\uff0c\u53d6\u6d88\u65b0\u5efa\u6536\u85cf\u5939<i class="blue-arrow"></i><i class="icon-close"></i></div>')+'<input class="fav-input" placeholder="\u6700\u591a\u8f93\u516515\u4e2a\u5b57"><div class="fav-new-btns">\u65b0\u5efa</div></div></div><div class="fav-sure-wrp"><div class="fav-sure">\u786e\u5b9a</div></div></div><iframe class="layout" frameborder=0></iframe></div>';this.currentTarget=null;this.$mask=$('<div class="wnd-mask"></div>');this.$wnd=null;this.maxNum=999;this.maxNameLen=15;this._status={ready:0,initializing:1,initialized:2,listLoaded:3};this.status=this._status.ready;this._scrollbarInitialized=this.stowed=!1;this._inFavList=[];this.createdFav=!1;this.collectStatus={};this.originCollectStatus={};this.init()}var c=localStorage.getItem("favCreateFolderTip")||!1;localStorage.getItem("favShowedNumChange");d.prototype={constructor:d,init:function(){var b=this;$.fn.mCustomScrollbar?(this.createWnd(),this.status=this._status.initialized):(this.status++,$('<link rel="stylesheet" type="text/css" href="//static.hdslb.com/plugins/mCustomScrollbar/jquery.mCustomScrollbar.min.css" />').appendTo("body"),this._getScript("//static.hdslb.com/plugins/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js",function(){b.createWnd();b.status++}))},createWnd:function(){var b=this;this.$wnd=$(this.template);this.$listWrp=this.$wnd.find(".fav-list-wrp");this.$list=this.$listWrp.find(".fav-list");this.$input=this.$wnd.find(".fav-input");this.$error=this.$wnd.find(".err-msg");this.$newFav=this.$wnd.find(".fav-new-btns");this.$loading=this.$wnd.find(".fav-list .loading");this.$wnd.on("click",function(e){e.stopPropagation()});this.$wnd.find(".b-icon-close").click(function(){b.close()});this.$wnd.find(".fav-new-placeholder").click(function(){b._toggleNew(!0);rec_rp("event","favoritewin_newbuilt")});this.$wnd.find(".fav-btn-cancel").click(function(){b._toggleNew(!1)});this.$input.on("keyup",function(a){a.stopPropagation();b._strCount(a)});this.$newFav.click(function(){b.createAndAddFav();rec_rp("event","favoritewin_newbuiltbtn")});this.$wnd.find(".fav-sure").click(function(){$(this).hasClass("on")&&b.action()});this.$wnd.find(".fav-mask").click(function(){b._toggleNew(!1)});this.$wnd.find(".fav-add-tip .icon-close").click(function(){localStorage.setItem("favCreateFolderTip","true");b.$wnd.find(".fav-add-tip").remove()})},show:function(g){utils.lockPageScroll("lock");this.currentTarget=g=$(g);var f=this;setTimeout(function(){f.$loading.show()},1000);if(this.status>=this._status.initialized){this.$mask.appendTo("body");var h=g.offset().top+g.outerHeight();g.offset();if(this.listCount){switch(this.listCount){case 1:this.$list.css({"min-height":"44px","margin-bottom":"112px"});break;case 2:this.$list.css({"min-height":"72px","margin-bottom":"112px"});break;case 3:this.$list.css({"min-height":"120px","margin-bottom":"112px"});break;case 4:this.$list.css({"min-height":"168px","margin-bottom":"112px"});break;default:this.$list.css({"min-height":"168px","margin-bottom":"112px"})}}this.$wnd.css({display:"none"});this.$wnd.appendTo("body").show();this.$wnd.css({display:"block","margin-top":"-"+this.$wnd.height()/2+"px"});h+this.$wnd.outerHeight()>$(window).height()+$(window).scrollTop()&&(h=$(window).height()+$(window).scrollTop()-this.$wnd.outerHeight()-10);if(this.status<this._status.listLoaded||this.stowed){this.status=this._status.listLoaded,this.$list.find(".list-item[default]").remove(),this.ajaxGet(null,"list",{aid:window.aid},function(b){f.render(b.data);f.listCount||f.$wnd.css("margin-top","-"+f.$wnd.height()/2+"px");f.$wnd.find(".fav-new-placeholder").show();1==b.data.length&&0==b.data[0].favoured&&f.autoAdd()})}this.stowed=!1;this.$wnd.focus()}},autoAdd:function(){this.$list.find(".list-item-name .radius-box").click()},close:function(){this.createdFav=!1;this._toggleNew(!1);this.$mask.remove();this.$wnd.hide();this.status=this._status.initialized;this._scrollbarInitialized=!1;this.init();utils.lockPageScroll("unlock")},render:function(g){50<=g.length&&this.unableCreateFolder();this.$list.find(".list-item").not("[default]").remove();4>=g.length?this.$wnd.find(".fav-list").css("margin-bottom","68px"):this.$wnd.find(".fav-list").css("margin-bottom","24px");this.$wnd.find(".fav-list .loading").remove();for(var f=0;f<g.length;f++){var h=g[f];h.favoured&&this.addToList(h)}for(f=0;f<g.length;f++){h=g[f],h.favoured||this.addToList(h)}this._scrollbarInitialized?this.$listWrp.mCustomScrollbar("update"):(this.$listWrp.mCustomScrollbar({axis:"y",scrollInertia:300,mouseWheel:{scrollAmount:100,preventDefault:!0},callbacks:{onTotalScrollOffset:12,onTotalScroll:function(){}}}),this._scrollbarInitialized=!0)},addToList:function(h,g){var k=this,j=$('<li data-id="'+h.fid+'" class="list-item '+(h.cur_count>=h.max_count&&2<=h.state&&!h.favoured?"lock":"")+'"><div class="list-item-name"><i class="radius-box '+(h.favoured?"on":"off")+'"></i>'+h.name+(3==h.state?'<i class="personal">[\u79c1\u5bc6]</i>':"")+'<div class="fav-count"></div></div></li>');!0===g?j.attr("default",!0).prependTo(this.$list):(j.appendTo(this.$list),this._favNumCount(j,h,g));j.find(".list-item-name").attr("title",h.name);this.originCollectStatus[h.fid]=this.collectStatus[h.fid]=!!h.favoured;j.on("click",function(){h.cur_count>=h.max_count&&2<=h.state&&!k.collectStatus[h.fid]||(k.collectStatus[h.fid]=!k.collectStatus[h.fid],k.collectStatus[h.fid]?($("i.radius-box",j).removeClass("off").addClass("on"),h.cur_count++):($("i.radius-box",j).removeClass("on").addClass("off"),h.cur_count--),k._favNumCount(j,h,g),k.checkSyn())});j.on("flash",function(){k._favNumCount(j,h,g)});return j},createAndAddFav:function(){var f=this,e=this.$input.val();if(!e){return(new MessageBox).show(f.$newFav,"\u8bf7\u586b\u5199\u6536\u85cf\u5939\u540d\u79f0"),!1}e=e.replace(/^[\s]+|[\s]+$/g,"");if(e.length>this.maxNameLen){return(new MessageBox).show(f.$newFav,"\u6536\u85cf\u5939\u540d\u8d85\u8fc7\u9650\u5236"),!1}if(""==e){return(new MessageBox).show(f.$newFav,"\u6536\u85cf\u5939\u540d\u4e0d\u80fd\u4e3a\u7a7a"),!1}f.$newFav.addClass("disabled");this.ajaxPost(this.$newFav,"create",{name:e,csrf:utils.cookie.get("bili_jct")},function(b){f.$input.val("");f._strCount();b=b.data.fid;var a={name:e,fid:b,count:1,cur_count:1,max_count:f.maxNum};4==f.$list.find("li").length&&f.$list.css("margin-bottom","28px");f.addToList(a);f.$listWrp.mCustomScrollbar("update");f._trigger("onCreate",f.currentTarget,a);f.$newFav.removeClass("disabled");f.collectStatus[b]=!0;f.$wnd.find("li[data-id="+b+"] .radius-box").removeClass("off").addClass("on");f._toggleNew(!1);50<=f.$wnd.find(".fav-list li").length&&f.unableCreateFolder();f.createdFav=!0;f.checkSyn()})},unableCreateFolder:function(){this.$wnd.find(".fav-new-placeholder").addClass("lock").off("click").on("click",function(){(new MessageBox).show($(this),"\u6536\u85cf\u5939\u4e2a\u6570\u5df2\u8fbe\u5230\u4e0a\u9650",2000)})},_setStow:function(b){0>$.inArray(b,this._inFavList)&&(this._inFavList.push(b),this.stowed=!0)},_favNumCount:function(g,f,h){g.find(".fav-count").text(f.cur_count+(0==f.state||1==f.state?"":"/"+f.max_count))},_strCount:function(j){var h=this.$input,m=this.$wnd.find(".fav-new-wrp"),l=h.siblings(".str-count"),h=h.val().replace(/\r\n?/,"\n").length,k=this.maxNameLen;l.html(h+"/"+k);h>k?m.addClass("error"):m.removeClass("error");j&&27==j.keyCode?this._toggleNew(!1):j&&13==j.keyCode&&this.createAndAddFav()},action:function(){var h=[],g=[],k=this.collectStatus;this.createdFav=!1;for(var j in k){k.hasOwnProperty(j)&&k[j]!=this.originCollectStatus[j]&&(k[j]?h.push(j):g.push(j))}h.length||g.length?((h.length||g.length)&&this.$list.find("li .radius-box.on"),this.synchronize(h,g)):this.close()},afterAction:function(){var g=!1,f=!1,h;for(h in this.collectStatus){this.originCollectStatus[h]&&(f=!0),this.collectStatus[h]&&(g=!0),this.originCollectStatus[h]=this.collectStatus[h]}!f&&g?this._trigger("onAdd",this.currentTarget):f&&!g&&this._trigger("onDel",this.currentTarget);this.close()},synchronize:function(h,g){var k=0,j=this;h.length?postJSONLite({url:"//api.bilibili.com/x/v2/fav/video/add",data:{aid:j.options.aid,fid:h.join(","),jsonp:"jsonp",csrf:utils.cookie.get("bili_jct")},dataType:"json",type:"post",xhrFields:{withCredentials:!0},success:function(b){b&&0==b.code?k++:(new MessageBox).show(j.$wnd.find(".fav-sure"),b.message,2000);2<=k&&j.afterAction()}}):k++;g.length?postJSONLite({url:"//api.bilibili.com/x/v2/fav/video/del",data:{aid:j.options.aid,fid:g.join(","),jsonp:"jsonp",csrf:utils.cookie.get("bili_jct")},dataType:"json",type:"post",xhrFields:{withCredentials:!0},success:function(b){b&&0==b.code?k++:(new MessageBox).show(j.$wnd.find(".fav-sure"),b.message,2000);2<=k&&j.afterAction()}}):k++},checkSyn:function(){var h=this.collectStatus,g=this.originCollectStatus,k=this.createdFav,j;for(j in h){h.hasOwnProperty(j)&&h[j]!=g[j]&&(k=!0)}k?this.$wnd.find(".fav-sure").addClass("on"):this.$wnd.find(".fav-sure").removeClass("on");return k},ajaxGet:function(){Array.prototype.unshift.call(arguments,"get");return this._ajax.apply(this,arguments)},ajaxPost:function(){Array.prototype.unshift.call(arguments,"post");return this._ajax.apply(this,arguments)},_toggleNew:function(b){b?(this.$wnd.find(".fav-new-wrp").show(),this.$wnd.find(".fav-new-placeholder").hide(),this.$wnd.find(".fav-new-wrp input")[0].focus(),this.$wnd.find(".fav-mask").show(),this.$listWrp.mCustomScrollbar("disable")):(this.$wnd.find(".fav-new-wrp").hide(),this.$wnd.find(".fav-new-placeholder").show(),this.$input.val(""),this._strCount(),this.$wnd.find(".fav-mask").hide(),this.$listWrp.mCustomScrollbar("update"))},_ajax:function(k,j,o,n,m,l){n={url:this.APIConfig.base+this.APIConfig.list[o],type:k,dataType:"get"==k?"jsonp":"json",data:$.extend(!0,{jsonp:"jsonp"},n),xhrFields:{withCredentials:!0},success:function(b){0==b.code||"default"==o&&b.list?m&&m.apply(this,arguments):j&&(61001===b.code||61002===b.code?$.getScript("//static.hdslb.com/common/js/identityDialog.js",function(){IdentityDialog(b.code,b.message)}):(!b.message&&b.code&&(11001==b.code?b.message="\u6536\u85cf\u5939\u540d\u79f0\u8fc7\u957f":11002==b.code?b.message="\u8fbe\u5230\u6700\u5927\u6536\u85cf\u5939\u6570":11005==b.code?b.message="\u89c6\u9891\u6570\u8fbe\u5230\u76ee\u5f55\u6700\u5927\u6536\u85cf\u6570":11006==b.code?b.message="\u5df2\u7ecf\u5b58\u5728\u8be5\u6536\u85cf\u5939":11007==b.code?b.message="\u5df2\u7ecf\u5b58\u5728\u8be5\u89c6\u9891\u4e86":11012==b.code?b.message="\u5df2\u7ecf\u5220\u9664\u8be5\u6536\u85cf\u5939\u4e86":-101==b.code?b.message="\u8d26\u53f7\u672a\u767b\u5f55":-102==b.code?b.message="\u8d26\u53f7\u88ab\u5c01\u505c":-103==b.code&&(b.message="\u60a8\u7684\u8d26\u53f7\u5df2\u7ecf\u88ab\u5c01\u7981")),(new MessageBox).show(j,b.message||"\u64cd\u4f5c\u5931\u8d25",1500)))},error:function(){l?l.apply(this,arguments):j&&(new MessageBox).show(j,"\u8bf7\u6c42\u5931\u8d25",1500)}};"post"==k?postJSONLite(n,"addFavCallback"+o):$.ajax(n)},_getScript:function(f,e){$.ajax({type:"GET",url:f,success:e,dataType:"script",cache:!0})},_trigger:function(){var f=Array.prototype.slice.call(arguments,0),e=f.shift();if(this.options[e]){return this.options[e].apply(this,f)}}};return window.FavList=d})();(function(){function b(F,E,D,C){function B(e){var d=this,c=$.Deferred(),a=new MessageBox({margin:8,Overlap:!0,focusShowPos:"down"});UserStatus.isLogin(this)&&(x?a.show(this,o):(v=!0,C?$.ajax({url:"//www.bilibili.com/activity/account/token",dataType:"json"}).done(function(f){f.code||!f.data?c.reject():$.ajax({url:"/activity/likes/like/"+E+"?oid="+F.lid+"&action="+e,type:"POST",data:{token:f.data}}).done(function(g){c.resolve(g)}).fail(function(){c.reject()})}):$.ajax({url:"/m/mission_vote",data:{aid:D,msid:E,vote:e}}).done(function(f){c.resolve(f)}).fail(function(){c.reject()}),c.done(function(g){var f,k="\u672a\u77e5\u9519\u8bef",h={0:t,"-1":"\u4e0d\u5728\u53ef\u8bc4\u5206\u65f6\u95f4\u5185","-2":"\u8bc4\u5206\u7684\u89c6\u9891\u4e0d\u5b58\u5728","-3":"\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u8bc4\u8fc7\u5206","-4":"\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u8bc4\u8fc7\u5206","-5":"\u8bc4\u5206\u6570\u91cf\u4e0d\u6b63\u786e","-6":"\u8bf7\u5148\u767b\u5f55","-7":"\u60a8\u5269\u4f59\u7684\u53ef\u8bc4\u5206\u70b9\u6570\u4e0d\u8db3","-403":null};C?g&&(f=g.code,h["-403"]=g.msg):f=g.toString();h[f]&&(k=h[f]);"0"==f?(x=!0,g="msg",z.find(".score-wrapper").off("mouseleave").find("li").off("hover click").attr("data-extra","default"),z.find(".b-btn-praise").attr("data-status","true").off("click")):(v=!1,g="error");a.show(d,k,1000,g)}).fail(function(){a.show(d,"\u8bf7\u6c42\u5931\u8d25");v=!1})))}if(F&&(!C||0!=F.lid&&null!=F.lid)){var A=$(".activity-wrp"),z=$('<div class="inside-wrp"><div class="left"><div class="l-inside"></div></div><div class="right"></div></div>');A.attr("data-up-name");A.attr("data-up-space");var y,w,t,o,x=!1,v=!1,j=+F.vote_start,H=+F.vote_end,G=window.serverdate;$(".viewbox .v-title").addClass("activity-enabled").find("h1").prepend('<a target="_blank" href="'+utils.trimHttp(F.single)+'" title="'+F.theme+'">\u6d3b\u52a8\u4f5c\u54c1</a>');y='<a class="inside-bg" target="_blank" href="'+utils.trimHttp(F.single)+'" title="'+F.theme+'"></a>';if(G>=j&&G<=H){A.addClass("act-now"),"1"==F.mission_zan?(t="\u70b9\u8d5e\u6210\u529f",o="\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u70b9\u8fc7\u8d5e",w='<div class="hinter-msg"><b> '+F.theme+" </b> </div>",w+='<div class="b-btn-praise" data-status="false">\u70b9\u8d5e</div>'):"0"==F.mission_zan&&(t="\u8bc4\u5206\u6210\u529f",o="\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u8bc4\u8fc7\u5206",w='<div class="hinter-msg"><b> '+F.theme+" </b> </div>",w+='<ul id="user_rate" class="score-wrapper clearfix"><li></li><li></li><li></li><li></li><li></li></ul>')}else{if(G>H){A.addClass("act-end"),w="\u672c\u89c6\u9891\u53c2\u52a0\u8fc7 <b>[ "+F.title+" ]</b> \u6d3b\u52a8\uff0c\u8be5\u6d3b\u52a8\u5df2\u7ed3\u675f~"}else{return}}z.find(".left .l-inside").html(w).end().find(".right").html(y).find(".inside-bg").css("background-image","url("+(F.zantext||"//static.hdslb.com/images/transparent.gif")+")").end().end();z.appendTo(A);z.find(".score-wrapper").mouseleave(function(){$(this).find("li").attr("data-extra","false")});hoverDelay(z.find(".score-wrapper li"),function(){var d=new MessageBox({margin:8,focusShowPos:"down"}),c=d.show(this,["\u4e00\u822c","\u8fd8\u884c","\u4e0d\u9519","\u5f88\u8d5e","\u60ca\u8273"][$(this).index()],0);c&&(c.css("min-width",0).find(".mini").css("padding","4px 8px").end(),d.setPos());$(this).prevAll().add(this).attr({"data-extra":"opacity","data-status":"true"});$(this).nextAll().attr({"data-extra":"false","data-status":"false"})},null,100);z.find(".score-wrapper li").click(function(){v||B.call(this,($(this).index()+1)*(C?1:2))});z.find(".b-btn-praise").click(function(){v||B.call(this,1)})}}$(document).ready(function(){var a=$(".activity-wrp");if(a.length&&"0"!=a.attr("data-vote")){var h,g=a.attr("data-msid"),f=$.ajax({url:"//interface.bilibili.com/serverdate.js",cache:!0,dataType:"script"});10000<parseInt(g)?(h=!0,a=$.ajax({url:"//www.bilibili.com/activity/subject/"+g,data:{aid:window.aid},dataType:"json"})):(h=!1,a=$.ajax({url:"//www.bilibili.com/plus/mission_vote.php",data:{act:"mission",msid:g},dataType:"json"}));$.when(a,f).done(function(c){if(c[0]&&!c[0].code){c=c[0].data;var d={};h?(d.mission_id=c.id,d.title=c.name,d.theme=c.dic,d.vote_start=(new Date(c.lstime)).getTime(),d.vote_end=(new Date(c.letime)).getTime(),d.single=c.act_url,d.zantext=c.cover,d.lid=c.lid,1==c.type?d.mission_zan=0:4==c.type&&(d.mission_zan=1)):d=c;b(d,g,window.aid,h)}})}})})();function measureDesc(){var e=$("#v_desc"),d=e.text(),f=$('<a href="javascript:;" style="position: absolute;right:0">\u5c55\u5f00\u66f4\u591a</a>');120<e.height()&&255>d.length?(e.css("height",120),f.insertAfter(e),f.click(function(){f[0].flag=!f[0].flag;f[0].flag?(f.text("\u6536\u8d77"),e.css("height","auto")):(f.text("\u5c55\u5f00\u66f4\u591a"),e.css("height",120))})):255<=d.length&&1!=parseInt(e.attr("data-desc"))&&(f.insertAfter(e),e.css("height",120),f.click(function(){$(this)[0].flag=!$(this)[0].flag;$(this)[0].flag?($(this).text("\u6b63\u5728\u52a0\u8f7d..."),$.ajax({url:"//api.bilibili.com/x/web-interface/archive/desc",dataType:"jsonp",type:"GET",data:{jsonp:"jsonp",aid:window.aid},cache:!0,jsonpCallback:"descInfo"}).done(function(a){a&&0===a.code&&(e.css("height","auto").html(utils.avLink(utils.smLink(utils.unhtml(a.data)))),f.text("\u6536\u8d77"))})):($(this).text("\u5c55\u5f00\u66f4\u591a"),e.css("height",120).html(d))}))}function checkLiveState(b){window.liveXhrDone=function(c){c.data&&c.data.status&&$('<a class="live-status-link" href="'+utils.trimHttp(c.data&&c.data.url)+'" target="_blank"><span>'+["","\u76f4\u64ad\u4e2d","\u8f6e\u64ad\u4e2d"][c.data.status]+"</span></a>").appendTo("#r-info-rank")};$.ajax({url:"//api.live.bilibili.com/bili/living_v2/"+b,dataType:"jsonp",cache:!0,jsonpCallback:"liveXhrDone"})}function EmbedPlayer(g,f,k){g={};var j=$("#bofqi").contents().filter(function(){return 3==this.nodeType}),h=j.text().match(/\[flashvars\](.*)\[\/flashvars\]/);null!=h&&(k=k+"&"+h[1],j.remove());k=k.split("&");for(j=0;j<k.length;j++){""!=k[j]&&(h=k[j].split("="),g[h[0]]=h[1])}swfobject.embedSWF(f,"player_placeholder","950","482","0","",g,{bgcolor:"#ffffff",allowfullscreeninteractive:"true",allowfullscreen:"true",quality:"high",allowscriptaccess:"always",wmode:"direct"},{"class":"player"})}function play_use_coop_player(g,f,k){var j=arguments.callee;if(k){var h=f.match(/id_([^.]+)/);h&&($("#bofqi").html('<div id="player_placeholder"></div>'),swfobject.embedSWF("//static.hdslb.com/youku.swf","player_placeholder","950","482","0","",{"bili-cid":g,url:"//player.youku.com/player.php/sid/"+h[1]+"/v.swf"},{allowfullscreeninteractive:"true",allowfullscreen:"true",quality:"high",allowscriptaccess:"always",wmode:"direct"},{"class":"player"}))}else{setTimeout(function(){j(g,f,!0)},0)}}$(function(){window.showRealNameBind=function(a,b){$.getScript("//static.hdslb.com/common/js/identityDialog.js",function(){IdentityDialog(a,b)})};measureDesc();addReturnToMobile();onLoginInfoLoaded(function(a){var b=$(".v-title-line.fav_btn"),c=b.find("i.b-icon"),d=new Animator({element:c,frameSource:"//static.hdslb.com/images/base/anim-collect.png",frameWidth:60,frameHeight:60,fps:24,totalFrame:21});b.on("mouseenter.anim",function(){c.hasClass("on")||d.start(1)}).on("mouseleave.anim",function(){d.back()});if(a.isLogin&&window.aid){var e=new FavList({aid:window.aid,onAdd:function(a){var c;$(".fav_btn").find(".b-icon-stow, .b-icon-anim-fav").addClass("on");$(".fav_btn").find(".stow-status, .t-right-top").html("\u5df2\u6536\u85cf");CacheManager.addItem("last_fav",parseInt(window.aid));d.options.totalFrame=30;d.options.offsetY=60;d.framePos=0;d.start();b.off("mouseenter.anim mouseleave.anim");c=$("#stow_count").html();c.match(/\u4e07/)||$("#stow_count, .stow_count").html(utils.formatNum(parseInt(c)+1));a.hasClass("v-stow")&&utils.customReport("playpage_collect1");a.hasClass("t")&&utils.customReport("playpage_collect2")},onDel:function(a){var e;$(".fav_btn").find(".b-icon-stow, .b-icon-anim-fav").removeClass("on");$(".fav_btn").find(".stow-status, .t-right-top").html("\u6536\u85cf");d.options.totalFrame=19;d.options.offsetY=0;d.framePos=0;d.start();b.on("mouseenter.anim",function(){c.hasClass("on")||d.start(1)}).on("mouseleave.anim",function(){d.back()});e=$("#stow_count").html();e.match(/\u4e07/)||$("#stow_count, .stow_count").html(utils.formatNum(parseInt(e)-1));a.hasClass("v-stow")&&utils.customReport("playpage_uncollect1");a.hasClass("t")&&utils.customReport("playpage_uncollect2")}});$.get("//api.bilibili.com/x/v2/fav/video/favoured",{aid:window.aid,jsonp:"jsonp"},function(a){0==a.code&&a.data.favoured&&($(".fav_btn").find(".b-icon-stow, .b-icon-anim-fav").addClass("on"),$(".fav_btn").find(".stow-status, .t-right-top").html("\u5df2\u6536\u85cf"),c.css("background-position","0 -120px"));e.listCount=a.data&&a.data.count},"jsonp")}$(".fav_btn, .fav_btn_top").on("click",function(a){if(UserStatus.isLogin($(this))){e&&e.show($(this))}else{return !1}});$(".block.watch-later").on("mouseenter.addWatchLater",function(a){a.stopPropagation()});a=$(".r-info > .f").attr("mid");if("undefined"!=typeof window.AttentionList&&"null"!=typeof window.AttentionList){for(var p=0;p<window.AttentionList.length&&window.AttentionList[p]!=a;p++){}}});$(".upinfo .message").on("click",function(a){$(this);UserStatus.isLogin($(this))||a.preventDefault()});$("#bofqi").length&&RecommendArea.create();LiveRecommendList.create();initToolBar();var a,b,c;window.aid?(a=window.aid,b="arc"):window.tp_id&&(a=window.tp_id,b="topic");if(a&&!window.bbComment){c=new bbFeedback(".comm",b,{autoLoad:!0});$("#load_comment").off("click").removeAttr("onclick").on("click",function(){c.show(a,1)});var d,e=function(a){var b=$("#l_id_"+d,a);0!=b.length&&(setTimeout(function(){$(document).scrollTop(b.offset().top-20)},0),b.parents(".reply").length?$(".re_ta",b).click():$(".huifu",b).click())};(b=window.location.href.match(/#fb,([0-9]+),([0-9]+),([0-9]+),(.+)$/))?(d=b[3],c.show(a,1,d,e)):(b=window.location.href.match(/#reply([0-9]+)$/))?(d=b[1],c.show(a,1,d,e)):c.show(a,1)}if(0<$('iframe[src^="https://secure.bilibili.com"]').size()||0<$('iframe[src^="https://ssl.bilibili.tv"]').size()){window.postMessage?(b=function(a){"https://secure.bilibili.com"!=a.origin&&"https://ssl.bilibili.com"!=a.origin||"secJS:"!=a.data.substr(0,6)||eval(a.data.substr(6));"undefined"!=typeof console&&console.log(a.origin+": "+a.data)},window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent&&window.attachEvent("onmessage",b)):setInterval(function(){if(evalCode=__GetCookie("__secureJS")){__SetCookie("__secureJS",""),eval(evalCode)}},1000)}__GetCookie("bbFrontManager")&&(b=window.aid||"",$('<script type="text/javascript" src="//static.hdslb.com/js/highcharts.js">\x3c/script>').appendTo("head"),$('<a href="//manager.bilibili.co/#/archive/modify/'+b+'" class="b-btn w" target=\'_blank\' >\u67e5\u770b\u65e5\u5fd7</a>').appendTo("#newtag"),$('<a href="javascript:;" class="b-btn w">\u5f39\u5e55\u7ba1\u7406</a>').appendTo("#newtag").click(function(){if(0<$(".dm_manage").length){$(".dm_manage").stop().slideToggle()}else{var a=$(this);$.ajax({url:"/html/dm_manage.html",dataType:"html",success:function(b){$(".dm_manage").length||$(b).prependTo(a.closest(".main-inner"))},error:function(){(new MessageBox).show(a,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5")}})}}));miniPlayer()});window.GetRandomString=function(g){for(var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),k="",j=0;j<g;j++){var h=Math.floor(62*Math.random()),k=k+f[h]}return k};function getDownloadUrl(d){var c="https://itunes.apple.com/cn/app/bi-li-bi-li-dong-hua/id736536022";browser.version.MicroMessenger?c="//a.app.qq.com/o/simple.jsp?pkgname=tv.danmaku.bili":browser.version.android?c="//wsdownload.hdslb.net/app/BiliPlayer_bilih5.apk":browser.version.ios?c="https://itunes.apple.com/cn/app/bi-li-bi-li-dong-hua/id736536022":browser.version.windowsphone&&(c="https://www.windowsphone.com/zh-cn/store/purchase/validate?app=75620dee-4a7a-4dae-8677-0d930e05f57e&apptype=regular&offer=3869edb1-e34c-469a-af6e-2c8a7856cb61");d&&($(d).attr("href",c),browser.version.android?$(d).attr("target","_self"):$(d).attr("target","_blank"),!browser.version.android||"360"!=__GetUrlValue("from")&&"undefined"==typeof AndroidWebview||$.getScript("//openbox.mobilem.360.cn/html/api/js/qstore.js",function(){$(d).click(function(){return qStore&&qStore.fn&&"function"==typeof qStore.fn.download?(qStore.fn.download("1343"),!1):!0})}));return c}function showDownloadPanel(f,e,h,g){window.location.href=getDownloadUrl();return !1}(function(d){function c(P){var O=d(this),N=null,M=!1,L="javascript:void(0);",K=d.extend({id:null,title:"\u8bf7\u5148\u4e0b\u8f7d\u5ba2\u6237\u7aef",content:"\u672c\u529f\u80fd\u7531\u5ba2\u6237\u7aef\u63d0\u4f9b _(:3\u300d\u2220)_",download:!1,aid:null,season_id:null,spid:null,room_id:null,mid:null,isBuffBtn:!1,isbangumi:!1,true_season_id:!1},P),J=Date.parse(new Date)/1000,H=GetRandomString(32),F=5,E=!1,I="bilibili://",G=d('<div class="float-notice"><div class="txt">\u8bf7\u70b9\u51fb\u53f3\u4e0a\u89d2\uff0c\u9009\u62e9\u201c<span>\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00</span>\u201d\uff0c\u518d\u70b9\u6253\u5f00\u5ba2\u6237\u7aef</div><div class="close"></div></div>').on("click",".close",function(){G.hide()}),D={packageName:"tv.danmaku.bilianime",packageUrl:"bilibili://"};browser.version.android&&(D={packageName:"tv.danmaku.bili"});var C=function(){G.appendTo("body").show()};P=function(f,e,g){L=getDownloadUrl();O.unbind("click");O.click(function(){browser.version.weibo?C():showDownloadPanel(f,e);return !1});g||O.click()};var A=function(e){var f=d(".app-link-iframe");f.length||(f=d("<iframe>").addClass("app-link-iframe").css({width:0,height:0}));f.hide().appendTo("body");f.attr("src",utils.trimHttp(e))},B=function(e){function g(b){clearTimeout(N);document.removeEventListener("visibilitychange",g,!1)}var f=+new Date;clearTimeout(N);N=setTimeout(function(){2000>+new Date-f&&("function"==typeof e?e():window.location=e)},1000);d(window).on("blur.applink",function(h){clearTimeout(N);d(window).off("blur.applink")});document.addEventListener("visibilitychange",g)},j=function(){O.attr({href:utils.trimHttp(L),target:"_blank"});browser.version.MicroMessenger?a():browser.version.android&&O.attr({target:"_self"});K.season_id&&K.true_season_id?I="bilibili://bangumi/season/"+K.season_id:K.spid?I=browser.version.android?"bilibili://"+(K.season_id?"bangumi/sp/"+K.spid:"splist/"+K.spid):"bilibili://"+(K.season_id?"bilibili.tv/bangumi?spid="+K.spid:"bilibili.tv/sp?spid="+K.spid):K.aid&&!K.isbangumi?I=browser.version.android?"bilibili://video/"+K.aid:"bilibili://?av="+K.aid:K.aid&&K.isbangumi?I=browser.version.android?"bilibili://video/"+K.aid:"bilibili://bangumi/season/av/"+K.aid:K.room_id?I="bilibili://live/"+K.room_id:K.mid&&(I="bilibili://author/"+K.mid);if(browser.version.windowsphone){O.on("click",function(){A(I)})}else{if(browser.version.android){O.on("click",function(){A(I);browser.version.MicroMessenger?o("appLink",I,function(){B(function(){E?C():z()})}):browser.version.weibo?B(function(){C()}):B(function(){z()});return !1})}else{browser.version.ios&&(O.attr({href:utils.trimHttp(I),target:"_self"}),O.on("click",function(){browser.version.MicroMessenger?o("appLink",I,function(){O.applink(function(){E?C():z()})}):browser.version.weibo?B(function(){C()}):B(function(){z()})}))}}M&&(setTimeout(function(){window.open(utils.trimHttp(L),"_self")},1000),M=!1)},z=function(){showDownloadPanel(K.title,K.content)},a=function(){d.ajax({url:"//app.bilibili.com/x/display/wechat/sign",type:"get",data:{url:window.location.href,timestamp:J,nonce:H,jsonp:"jsonp"},dataType:"jsonp",success:function(e){e&&0==e.code&&d.getScript("//res.wx.qq.com/open/js/jweixin-1.0.0.js",function(){wx&&(wx.config({beta:!0,debug:!1,appId:"wx108457cda8a1b9f9",nonceStr:H,timestamp:J,signature:e.data,jsApiList:"getInstallState launch3rdApp onMenuShareTimeline onMenuShareAppMessage onMenuShareQQ onMenuShareWeibo onMenuShareQZone".split(" ")}),wx.ready(function(){wx.invoke("getInstallState",D,function(g){for(var f in g){"err_msg"==f&&0<g[f].indexOf("yes")&&(E=!0)}})}))})},error:function(){E=!1}})},o=function(f,e,g){wx?wx.invoke("launch3rdApp",{appID:"wxcb8d4298c6a09bcb",messageExt:e,extInfo:e},function(k){for(var h in k){"err_msg"==h&&("launch_3rdApp:ok"==k[h]?E=!0:"function"==typeof g&&g())}}):0>=F?"function"==typeof g&&g():(F--,setTimeout(function(){o(f,e,g)},300))};K.download?P(K.title,K.content,!0):j()}d.fn.bindApplink=function(b){this.each(function(){c.call(this,b)});return this}})($);function loadRelation(b){$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:mid,jsonp:"jsonp"},dataType:"jsonp"}).done(function(a){0===a.code&&(window.AttentionList=window.AttentionList||[],1===a.data.attribute||2===a.data.attribute||6===a.data.attribute?(-1==window.AttentionList.indexOf(mid)&&window.AttentionList.push(parseInt(mid)),1===a.data.attribute&&(window.isQuietAttention=!0),$(".r-info > .f").text("\u5df2\u5173\u6ce8"),$(".r-info > .f").addClass("on"),bindRIUnattent(),b&&b(!0)):($(".r-info > .f").text("+ \u5173\u6ce8"),bindRIAttent(),b&&b(!1)))})}$(document).ready(function(){var e=$(".r-info").find(".usname"),d=e.find("a.message").attr("mid")||window.mid,f=$("#r-info-rank");d&&($.ajax({url:"//api.bilibili.com/vipinfo/default",data:{type:"jsonp",mid:d,loginid:__GetCookie("DedeUserID")},dataType:"jsonp",jsonCallback:"jsonp_z_vipinfo"}).done(function(a){a&&(!a.code&&a.data)&&(a=a.data,a.vip&&2==a.vip.vipType&&0!=a.vip.vipStatus&&2!=a.vip.vipStatus?e.find("a.name").addClass("b-vip-red"):e.find("a.name").removeClass("b-vip-red"),$(".r-info > .f").removeClass("hide"),bindRIAttent(),a.archiveCount&&$(".up-video-message .archiveCount").attr("title","\u6295\u7a3f\u6570"+a.archiveCount).text("\u6295\u7a3f\uff1a"+a.archiveCount),f.find(".legalize-icon").remove(),0==a.official_verify.type?f.append('<div class="legalize-icon legalize-16-1" title="\u4e2a\u4eba\u8ba4\u8bc1"></div>'):1==a.official_verify.type&&f.append('<div class="legalize-icon legalize-16-2" title="\u4f01\u4e1a/\u56e2\u4f53\u8ba4\u8bc1"></div>'),void 0!==__GetCookie("DedeUserID")&&__GetCookie("DedeUserID")&&loadRelation())}),$.ajax({url:"//api.bilibili.com/cardrich?",data:{mid:window.mid,type:"jsonp"},dataType:"jsonp"}).done(function(b){b=b&&b.data&&b.data.card&&b.data.card.fans;$(".up-video-message .archiveCount+div").attr("title","\u7c89\u4e1d\u6570"+b).text("\u7c89\u4e1d\uff1a"+utils.formatNum(b))}))});$(function(){var b={makeParams:function(){var c=getAuthorInfo();return{title:$(".v-title h1").attr("title"),pic:$(".cover_image").attr("src"),tname:$('[typeof="v:Breadcrumb"] a').eq(0).text(),aid:window.aid,owner:{face:c.face,mid:c.mid,name:c.uname},view_at:Date.parse(new Date)/1000}},getHsData:function(){if(window.localStorage){var d=window.localStorage;if(d.biliHistoryData){return JSON.parse(d.biliHistoryData)}var e=[];d.setItem("biliHistoryData",JSON.stringify(e));return e}return !1},setHsData:function(){if(window.localStorage){var e=window.localStorage,g=this.getHsData(),f=this.makeParams();g.push(f);e.setItem("biliHistoryData",JSON.stringify(g))}else{return !1}}};onLoginInfoLoaded(function(a){a.isLogin||b.setHsData()})});