(function(a){var e="click.appeal";var l="current";var t="";var i=a("body");var s=a("div.tminfo");var o="https://api.bilibili.com/x/elec/appeal";var n="https://api.bilibili.com/x/upload";var r="";var p=0;function c(){s.append('<a href="javascript:;" class="charge-appeal-init">稿件投诉</a>');i.append(['<div class="appeal-mask"></div>','<div class="appeal-floatbox">',"<h3>稿件投诉</h3>",'<a href="javascript:;" class="appeal-floatbox-close floatbox-btn-cancel"></a>','<div class="appeal-floatbox-operation current">','<div class="appeal-floatbox-main">','<p>你觉得这个稿件<span class="appeal-gray">（av'+b()+"）</span>有什么问题？</p>",'<label><input type="radio" name="reason" value="1" class="appeal-radio-reason"/>存在色情、暴力、反动内容</label>','<label><input type="radio" name="reason" value="2" class="appeal-radio-reason"/>存在版权问题</label>','<label><input type="radio" name="reason" value="5" class="appeal-radio-reason"/>与站内其他视频撞车</label>','<label class="elec-input"><input type="radio" name="reason" value="3" class="appeal-radio-reason"/> 不能参加充电计划：非自制作品</label>','<label class="elec-input"><input type="radio" name="reason" value="4" class="appeal-radio-reason"/> 不能参加充电计划：有商业推广内容</label>','<label><input type="radio" name="reason" value="0" class="appeal-radio-reason"/> 有其它问题</label>',"</div>",'<div class="appeal-floatbox-content current">','<p class="appeal-floatbox-reasontit">为帮助审核人员更快处理, 请补充<span class="appeal-red">问题类型和出现位置</span>等详细信息</p>','<div class="appeal-textarea-wrp"><textarea class=""></textarea>','<span class="appeal-floatbox-number"><i>0</i>/400</span></div>','<div class="appeal-floatbox-imgfile">','<div id="upload_image_file">','<div class="appeal-filebtn-label" id="appeal-floatbox-filebtn">选择文件</div>','<span class="appeal-floatbox-explain">每张小于2M，支持JPG/PNG等格式，最多上传5张</span>','<ul class="appeal-filelist"></ul>',"</div>","</div>",'<div class="appeal-floatbox-btn">','<p class="appeal-floatbox-submitemsg"></p>','<button class="floatbox-btn-submit">提交投诉</button>','<button class="floatbox-btn-cancel">取消</button>',"</div>","</div>",'<div class="appeal-floatbox-copyright">','<p>如果您认为这个稿件作品侵犯了您的相关权益，请<a href="//www.bilibili.com/html/copyright.html" target="_blank">点击这里</a></p>',"</div>","</div>",'<div class="appeal-floatbox-result">','<p class="floatbox-result-msg">您的投诉已经成功提交，工作人员会尽快处理的～</p>','<div><img src="//static.hdslb.com/images/base/appeal_finally.png"/></div>','<button type="button" class="floatbox-btn-cancel">确定</button>',"</div>","</div>"].join(""));d()}function d(){var i=true;var n="visibility";var c=window.location.href;var d=a("a.charge-appeal-init",s);var v=a("div.appeal-floatbox");var m=a("div.appeal-floatbox-content",v);var h=a("div.appeal-floatbox-copyright",v);var _=a("button.floatbox-btn-submit",v);var w=a(".floatbox-btn-cancel",v);var y=a("div.appeal-floatbox-operation",v);var C=a("div.appeal-floatbox-result",v);var k=a("p.appeal-floatbox-submitemsg",v);var j=a("textarea",m);var U=a("span.appeal-floatbox-number i",v);var O=a("label.elec-input",v);var S=a(".appeal-red",v);var I=0;O.hide();f();d.unbind(e).bind(e,function(){if(UserStatus.isLogin()){k.html(t);a("input:radio[name=reason]").attr("checked",false);j.val(t);U.html(0);y.addClass(l);C.removeClass(l);var e=a(".upinfo");var i=e.find(".elec");if(e.length&&i.length&&i.is(":visible")){O.show()}x(1)}else{window.location.href="https://account.bilibili.com/login?gourl="+c+""}utils.customReport("playpage_complain")});j.on("keyup",function(){I=a(this).val().length;j.css("border-color","#000");if(I>400){i=false}else{i=true}U.html(I)});a("input:radio[name=reason]").change(function(){var e=a(this).val();m.addClass(l);h.removeClass(l);if(e==="2"){m.removeClass(l);h.addClass(l)}if(e==1){S.text("违规内容出现位置")}else if(e==3){S.text("转载来源")}else if(e==4){S.text("商业元素出现位置")}else if(e==5){S.text("重复稿件av号")}else{S.text("问题类型和出现位置")}});w.unbind(e).bind(e,function(){x(0);r="";u("close");p=0;j.css("border-color","#000")});_.unbind(e).bind(e,function(){var e=a("input[name='reason']:checked").val();var s=j.val();if(e==undefined){k.html("请选择投诉原因");return}if(!s||!s.length){k.html("请补充详细信息");j.css("border-color","red");return}if(s.length>400){k.html("投诉理由只允许输入400个字符");j.css("border-color","red");return}var n="bili_appeal_"+b();try{var p=Date.now();var c=JSON.parse(localStorage.getItem(n)).date||0;var d=p-c<=24*60*60*1e3}catch(a){}if(d){g(a("button.floatbox-btn-submit"),"您已经投诉过这个稿件了，我们会尽快处理您的投诉的。");return}if(!i){return}a.ajax({url:o,type:"POST",data:{jsonp:"jsonp",aid:b(),type:parseInt(e),reason:j.val()||t,pics:r},dataType:"json",xhrFields:{withCredentials:true},success:function(e){if(e.code===0){try{localStorage.setItem(n,JSON.stringify({date:(new Date).getTime()}))}catch(a){}y.removeClass(l);C.addClass(l)}else if(e.code===13004){g(a("button.floatbox-btn-submit"),"该稿件已经被屏蔽");a(".floatbox-btn-cancel").trigger("click")}else if(e.code!=0){g(a("button.floatbox-btn-submit"),"稿件投诉失败")}},error:function(){g(a("button.floatbox-btn-submit"),"网络故障，要不要再试一下？")}})})}function f(){tsUploader=new plupload.Uploader({runtimes:"html5,html4",browse_button:"appeal-floatbox-filebtn",max_retries:0,multi_selection:false,url:"https://api.bilibili.com/x/upload",multipart:true,max_file_count:5,multipart_params:{jsonp:"jsonp",aid:b()},required_features:{send_browser_cookies:true},filters:{max_file_size:"2mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png"}],prevent_duplicates:false},init:{PostInit:function(){},FilesAdded:function(e,l){if(p>4){g(a("#appeal-floatbox-filebtn"),"最多上传5张图片哦")}else{tsUploader.start();v();tsUploader.disableBrowse(true)}return false},Error:function(e,l){if(l.code===-600){g(a("#appeal-floatbox-filebtn"),"图片大小限制在2mb以内，请重新选择")}else{g(a("#appeal-floatbox-filebtn"),"上传图片错误，请重试")}tsUploader.disableBrowse(false)},FileUploaded:function(e,l,t){var i=JSON.parse(t.response);tsUploader.disableBrowse(false);if(i.code===0){var s=utils.trimHttp(i.data.url);a("li.filelist-item").eq(a("li.filelist-item").size()-1).find("img").attr("src",s);if(r){r+=","+s}else{r=s}}},UploadProgress:function(a,e){}}});tsUploader.init()}c();function b(){var a=window.location.href;var e=a.match(/\/av\d+\//)[0]||"";var l=e.match(/\d+/)[0];return l}function u(e){var l="appeal-filebtn-addimg";var t=a("div.appeal-filebtn-label");var i=a("span.appeal-floatbox-explain");t.removeClass(l);i.show();t.css("left",0);if(e){a("ul.appeal-filelist").html("");return}if(a("li.filelist-item").size()>0){t.addClass(l);i.hide();a("div.appeal-filebtn-addimg").css("left",71*a("li.filelist-item").size()+"px")}}function v(){if(p>=5){return}p++;a("ul.appeal-filelist").append('<li class="filelist-item"><span class="filelist-item-delbtn icon-delete">x</span><a href="jsvascript:;"><img src="//static.hdslb.com/mstation/images/appeal/loading.gif"/></a></li>');u();a("span.filelist-item-delbtn").unbind().bind("click",function(){var e=utils.trimHttp(a(this).parent(".filelist-item").find("img").attr("src"));var l=r.split(",");for(var t=0;t<l.length;t++){if(e==l[t]){l.splice(t,1);p--}}r=l.join(",");a(this).parent(".filelist-item").remove();u()})}function m(e){var l=a("div.appeal-floatbox");var t=a("span.appeal-floatbox-explain",l);var i=a("label.appeal-filebtn-label",l);var s="appeal-filebtn-addimg";t.show();i.removeClass(s);if(e){t.hide();i.addClass(s)}}function x(e){var t=a("div.appeal-floatbox");var i=a("div.appeal-mask");if(e){t.addClass(l);i.addClass(l)}else{t.removeClass(l);i.removeClass(l)}}function h(a){if(document.cookie.length>0){c_start=document.cookie.indexOf(a+"=");if(c_start!=-1){c_start=c_start+a.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return""}function g(a,e){var l=new MessageBox({Overlap:true});l.show(a,e,1e3,"info")}})(jQuery);